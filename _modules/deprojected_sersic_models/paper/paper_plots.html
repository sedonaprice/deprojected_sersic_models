<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>deprojected_sersic_models.paper.paper_plots &mdash; deprojected_sersic_models 1.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/sersicprof-red-thick-64.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> deprojected_sersic_models
            <img src="../../../_static/logo_white.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">deprojected_sersic_models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../downloads.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../acknowledgement.html">Acknowledging <code class="docutils literal notranslate"><span class="pre">deprojected_sersic_models</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../deprojected_sersic_models_table_interp_example.html">Pre-calculated tables &amp; interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deprojected_sersic_models_profile_example.html">Calculating deprojected SÃ©rsic profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deprojected_sersic_models_plot_example.html">Built-in plotting functions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">deprojected_sersic_models</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">deprojected_sersic_models.paper.paper_plots</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for deprojected_sersic_models.paper.paper_plots</h1><div class="highlight"><pre>
<span></span><span class="c1">##################################################################################</span>
<span class="c1"># deprojected_sersic_models/paper/paper_plots.py                                 #</span>
<span class="c1">#                                                                                #</span>
<span class="c1"># Copyright 2018-2022 Sedona Price &lt;sedona.price@gmail.com&gt; / MPE IR/Submm Group #</span>
<span class="c1"># Licensed under a 3-clause BSD style license - see LICENSE.rst                  #</span>
<span class="c1">##################################################################################</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">dill</span> <span class="k">as</span> <span class="nn">pickle</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">scp_interp</span>

<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">FixedLocator</span><span class="p">,</span> <span class="n">FixedFormatter</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

<span class="kn">from</span> <span class="nn">deprojected_sersic_models</span> <span class="kn">import</span> <span class="n">core</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">table_generation</span>
<span class="kn">from</span> <span class="nn">deprojected_sersic_models.utils</span> <span class="kn">import</span> <span class="n">calcs</span> <span class="k">as</span> <span class="n">util_calcs</span>
<span class="kn">from</span> <span class="nn">deprojected_sersic_models.paper</span> <span class="kn">import</span> <span class="n">plot_calcs</span>
<span class="kn">from</span> <span class="nn">deprojected_sersic_models.paper</span> <span class="kn">import</span> <span class="n">scaling_rel</span>
<span class="kn">from</span> <span class="nn">deprojected_sersic_models.utils</span> <span class="kn">import</span> <span class="n">interp_profiles</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;make_all_paper_plots&#39;</span><span class="p">,</span> <span class="s1">&#39;list_table1_values&#39;</span> <span class="p">]</span>

<span class="c1"># ---------------------</span>
<span class="c1"># Plot settings</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.usetex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">fontsize_leg_sm</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="n">fontsize_leg</span> <span class="o">=</span> <span class="mf">11.</span>
<span class="n">fontsize_labels</span> <span class="o">=</span> <span class="mf">14.</span>
<span class="n">fontsize_labels_sm</span> <span class="o">=</span> <span class="mf">12.</span>
<span class="n">fontsize_ann</span> <span class="o">=</span> <span class="mf">11.</span>
<span class="n">fontsize_title</span><span class="o">=</span> <span class="mf">14.</span>
<span class="n">fontsize_title_lg</span> <span class="o">=</span> <span class="mf">16.</span>
<span class="n">fontsize_ticks</span> <span class="o">=</span> <span class="mf">12.</span>
<span class="n">fontsize_ticks_sm</span> <span class="o">=</span> <span class="mf">11.</span>

<span class="n">fontsize_ann_lg</span> <span class="o">=</span> <span class="mf">13.</span>
<span class="n">fontsize_ann_latex_sm</span> <span class="o">=</span> <span class="mf">12.</span>
<span class="n">fontsize_ann_latex</span> <span class="o">=</span> <span class="mf">13.</span>

<span class="n">cmap_mass</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">OrRd</span>
<span class="n">cmap_q</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">magma_r</span>
<span class="n">cmap_n</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">viridis_r</span>
<span class="n">cmapg</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Greys</span>


<span class="n">cmap_bt</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;cmap_bt&#39;</span><span class="p">,</span>
            <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.9568627450980393</span><span class="p">,</span> <span class="mf">0.4745098039215686</span><span class="p">,</span> <span class="mf">0.4745098039215686</span><span class="p">)],</span>
             <span class="n">N</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>
<span class="n">cmap_D2t_ref</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">GnBu_r</span>
<span class="n">ref_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">arr_tuples</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">rv</span> <span class="ow">in</span> <span class="n">ref_vals</span><span class="p">:</span>
    <span class="n">arr_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_D2t_ref</span><span class="p">(</span><span class="n">rv</span><span class="p">))</span>
<span class="n">cmap_D2t</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;cmap_D2t&#39;</span><span class="p">,</span> <span class="n">arr_tuples</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>


<span class="n">_dir_deprojected_sersic_models</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;DEPROJECTED_SERSIC_MODELS_DATADIR&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>



<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="list_table1_values"><a class="viewcode-back" href="../../../api/deprojected_sersic_models.paper.paper_plots.list_table1_values.html#deprojected_sersic_models.paper.paper_plots.list_table1_values">[docs]</a><span class="k">def</span> <span class="nf">list_table1_values</span><span class="p">(</span><span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">4.</span><span class="p">],</span> <span class="n">q_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span>
                       <span class="n">rfac_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">2.2</span><span class="o">/</span><span class="mf">1.678</span><span class="p">],</span> <span class="n">recalculate_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper to list ktot, k3D values for Table 1.</span>

<span class="sd">    Prints values to output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to the directory where the Sersic profile tables are located.</span>
<span class="sd">            Default: system variable `DEPROJECTED_SERSIC_MODELS_DATADIR`, if specified.</span>

<span class="sd">        n_arr: array_like, optional</span>
<span class="sd">            Array of Sersic indices to show</span>
<span class="sd">        q_arr: array_like, optional</span>
<span class="sd">            Array of intrinsic axis ratios to show</span>
<span class="sd">        rfac_arr: array_like, optional</span>
<span class="sd">            Array of radii to show, with R=R_fac_arr*Re</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">table_path</span> <span class="o">=</span> <span class="n">_dir_deprojected_sersic_models</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;                 ||      ktot      ||      k3D       &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------||----------------||----------------&quot;</span><span class="p">)</span>
    <span class="n">strout</span> <span class="o">=</span> <span class="s2">&quot;n          q     ||&quot;</span>
    <span class="n">strrs</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">rf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rfac_arr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">strrs</span> <span class="o">+=</span> <span class="s2">&quot;R=&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strrs</span> <span class="o">+=</span> <span class="s2">&quot;   &quot;</span>
        <span class="k">if</span> <span class="n">rf</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">strrs</span> <span class="o">+=</span> <span class="s2">&quot;Re&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strrs</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:0.1f}</span><span class="s2">Re&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span>
    <span class="n">strrs</span> <span class="o">+=</span> <span class="s2">&quot;  &quot;</span>
    <span class="n">strout</span> <span class="o">+=</span> <span class="n">strrs</span> <span class="o">+</span> <span class="s2">&quot;||&quot;</span> <span class="o">+</span> <span class="n">strrs</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">strout</span><span class="p">)</span>


    <span class="n">k3d_ellip_arr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_arr</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q_arr</span><span class="p">):</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">q</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">recalculate_all</span><span class="p">:</span>
                <span class="n">sprof</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">DeprojSersicModel</span><span class="p">(</span><span class="n">total_mass</span><span class="o">=</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">],</span>
                                                      <span class="n">Reff</span><span class="o">=</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>

            <span class="n">ktot_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">k3d_arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rfac</span> <span class="ow">in</span> <span class="n">rfac_arr</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">recalculate_all</span><span class="p">:</span>
                    <span class="n">ktot_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sprof</span><span class="o">.</span><span class="n">virial_coeff_tot</span><span class="p">(</span><span class="n">rfac</span><span class="o">*</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]))</span>
                    <span class="n">k3d_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sprof</span><span class="o">.</span><span class="n">virial_coeff_3D</span><span class="p">(</span><span class="n">rfac</span><span class="o">*</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rfac</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span>
                        <span class="c1"># Use table values</span>
                        <span class="n">ktot_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;ktot_Reff&#39;</span><span class="p">])</span>
                        <span class="n">k3d_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;k3D_sph_Reff&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Interpolate &amp; calculate:</span>
                        <span class="n">R</span> <span class="o">=</span> <span class="n">rfac</span><span class="o">*</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
                        <span class="n">table_rfac</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_entire_table</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">R</span><span class="p">,</span>
                                            <span class="n">total_mass</span><span class="o">=</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">],</span>
                                            <span class="n">Reff</span><span class="o">=</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">],</span>
                                            <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">q</span><span class="p">,</span>
                                            <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>

                        <span class="n">m3D</span> <span class="o">=</span> <span class="n">table_rfac</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">]</span>
                        <span class="n">vc</span> <span class="o">=</span>  <span class="n">table_rfac</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>
                        <span class="n">ktot_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">util_calcs</span><span class="o">.</span><span class="n">virial_coeff_tot</span><span class="p">(</span><span class="n">R</span><span class="p">,</span>
                                        <span class="n">total_mass</span><span class="o">=</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">],</span> <span class="n">vc</span><span class="o">=</span><span class="n">vc</span><span class="p">))</span>
                        <span class="n">k3d_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">util_calcs</span><span class="o">.</span><span class="n">virial_coeff_3D</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">m3D</span><span class="o">=</span><span class="n">m3D</span><span class="p">,</span> <span class="n">vc</span><span class="o">=</span><span class="n">vc</span><span class="p">))</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">q</span> <span class="o">==</span> <span class="mf">0.4</span><span class="p">):</span>
                            <span class="n">m3D_ellip</span> <span class="o">=</span> <span class="n">table_rfac</span><span class="p">[</span><span class="s1">&#39;menc3D_ellipsoid&#39;</span><span class="p">]</span>
                            <span class="n">k3d_ellip_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">util_calcs</span><span class="o">.</span><span class="n">virial_coeff_3D</span><span class="p">(</span><span class="n">R</span><span class="p">,</span>
                                            <span class="n">m3D</span><span class="o">=</span><span class="n">m3D_ellip</span><span class="p">,</span> <span class="n">vc</span><span class="o">=</span><span class="n">vc</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">strout</span> <span class="o">=</span> <span class="s1">&#39;n=</span><span class="si">{:4.1f}</span><span class="s1">     &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">strout</span> <span class="o">=</span> <span class="s1">&#39;           &#39;</span>
            <span class="n">strout</span> <span class="o">+=</span> <span class="s1">&#39;q=</span><span class="si">{:0.1f}</span><span class="s1"> ||  &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">kt</span> <span class="ow">in</span> <span class="n">ktot_arr</span><span class="p">:</span>
                <span class="n">strout</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:0.3f}</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kt</span><span class="p">)</span>
            <span class="n">strout</span> <span class="o">+=</span> <span class="s2">&quot;||  &quot;</span>
            <span class="k">for</span> <span class="n">k3d</span> <span class="ow">in</span> <span class="n">k3d_arr</span><span class="p">:</span>
                <span class="n">strout</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:0.3f}</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k3d</span><span class="p">)</span>


            <span class="nb">print</span><span class="p">(</span><span class="n">strout</span><span class="p">)</span>


    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------&quot;</span><span class="p">)</span>

    <span class="n">strout</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">k3d_ellip</span> <span class="ow">in</span> <span class="n">k3d_ellip_arr</span><span class="p">:</span>
        <span class="n">strout</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{:0.3f}</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k3d_ellip</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Miller+11 comparison points: &quot;</span><span class="o">+</span><span class="n">strout</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>

<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="make_all_paper_plots"><a class="viewcode-back" href="../../../api/deprojected_sersic_models.paper.paper_plots.make_all_paper_plots.html#deprojected_sersic_models.paper.paper_plots.make_all_paper_plots">[docs]</a><span class="k">def</span> <span class="nf">make_all_paper_plots</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper function to make all plots for the paper.</span>

<span class="sd">    Saves plots in PDF format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to the directory where the plots will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to the directory where the Sersic profile tables are located.</span>
<span class="sd">            Default: system variable `DEPROJECTED_SERSIC_MODELS_DATADIR`, if specified.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">table_path</span> <span class="o">=</span> <span class="n">_dir_deprojected_sersic_models</span>

    <span class="c1"># Figure 1</span>
    <span class="n">plot_compare_mencl</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span> <span class="n">q_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>

    <span class="c1"># Figure 2</span>
    <span class="n">plot_rhalf_3D_sersic_potential</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span>
        <span class="n">q_arr_plotq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]),</span>
        <span class="n">n_arr_plotn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">]))</span>

    <span class="c1"># Figure 3</span>
    <span class="n">plot_composite_menc_vcirc_profile_invert</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span>
                <span class="n">total_mass</span> <span class="o">=</span> <span class="mf">5.e10</span><span class="p">,</span> <span class="n">Reff</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
                <span class="n">q_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">n_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">])</span>

    <span class="c1"># Figure 4</span>
    <span class="n">plot_virial_coeff</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span>
                <span class="n">q_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">])</span>

    <span class="c1"># Figure 5</span>
    <span class="c1"># Use toy scaling relations / empirical approximations:</span>
    <span class="c1"># z = 2, lmstar=10.5, which gives:</span>
    <span class="c1"># Mstar =  3.2e10 (3.1623e10)</span>
    <span class="c1"># Mbar = 6.6e10 (6.64947e10) / lMbar = 10.82,</span>
    <span class="c1"># Mhalo = 8.9e11 (8.8618527e11) / lMhalo = 11.9475,</span>
    <span class="c1"># halo_conc = 4.2 (4.1931)</span>
    <span class="c1"># Reff_disk = 3.4  (3.400257)</span>
    <span class="c1"># qdisk = 0.25 or invq = 4</span>
    <span class="n">plot_example_galaxy_mencl_vcirc</span><span class="p">(</span><span class="n">bt_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span>
                <span class="n">Mbaryon</span><span class="o">=</span><span class="mf">6.6e10</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">Mhalo</span><span class="o">=</span><span class="mf">8.9e11</span><span class="p">,</span> <span class="n">halo_conc</span><span class="o">=</span><span class="mf">4.2</span><span class="p">,</span>
                <span class="n">Reff_disk</span><span class="o">=</span><span class="mf">3.4</span><span class="p">,</span> <span class="n">n_disk</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">invq_disk</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span>
                <span class="n">Reff_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">n_bulge</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">invq_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                <span class="n">logradius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mf">15.</span><span class="p">,</span> <span class="n">rstep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>



    <span class="c1"># Figure 6</span>
    <span class="n">plot_fdm_calibration</span><span class="p">(</span><span class="n">Mbaryon_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">6.6e10</span><span class="p">],</span> <span class="n">Reff_disk_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">3.4</span><span class="p">],</span>
                <span class="n">q_disk_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
                <span class="n">Mhalo_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">8.9e11</span><span class="p">],</span> <span class="n">halo_conc_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">4.2</span><span class="p">],</span>
                <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span> <span class="n">del_fDM</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Figure 7</span>
    <span class="n">plot_rhalf3DReD_fdm_calibration_ReB_ReD_rhalf3D</span><span class="p">(</span><span class="n">Mbaryon</span><span class="o">=</span><span class="mf">6.6e10</span><span class="p">,</span>
                <span class="n">q_disk_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
                <span class="n">ReB_to_ReD_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">n_disk</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                <span class="n">n_bulge</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">invq_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">Reff_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                <span class="n">z</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">Mhalo</span><span class="o">=</span><span class="mf">8.9e11</span><span class="p">,</span> <span class="n">halo_conc</span><span class="o">=</span><span class="mf">4.2</span><span class="p">,</span>
                <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span> <span class="n">del_fDM</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Figure 8</span>
    <span class="n">plot_toy_impl_fDM_calibration_z_evol</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span>
                <span class="n">n_disk</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">Reff_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">n_bulge</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">invq_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">del_fDM</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Figure 9</span>
    <span class="n">plot_alpha_vs_R</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span>
                <span class="n">n_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">],</span> <span class="n">show_literature</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Figure 10</span>
    <span class="n">plot_AD_sersic_potential_alpha_vs_R</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span>
                <span class="n">sigma0_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">30.</span><span class="p">,</span> <span class="mf">60.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">],</span> <span class="n">q_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">n_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
                <span class="n">total_mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="mf">10.5</span><span class="p">),</span> <span class="n">Reff</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>

    <span class="c1"># Figure 11</span>
    <span class="n">plot_composite_alpha_bulge_2disk_vs_r</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">,</span>
                <span class="n">nDisk</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">nBulge</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">bt_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.</span><span class="p">],</span>
                <span class="n">ReB_to_ReD_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">show_BT</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_D2T</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 1</span>

<span class="k">def</span> <span class="nf">plot_compare_mencl</span><span class="p">(</span><span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">q_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the fractional 3D spherical enclosed mass profile versus radius,</span>
<span class="sd">    for a range of Sersic indices n (n=1..8) and intrinsic axis ratios q.</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to directory containing the Sersic profile tables.</span>

<span class="sd">        q_arr: array_like, optional</span>
<span class="sd">            Range of intrinsic axis ratios to plot. Default: q_arr = [1., 0.4, 0.2]</span>
<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;mencl_sersic_potential&#39;</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_arr</span><span class="p">:</span>
            <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_q</span><span class="si">{:0.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>

    <span class="n">nmin</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">nmax</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">nstep</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">nrange</span> <span class="o">=</span> <span class="n">nmax</span><span class="o">-</span><span class="n">nmin</span>
    <span class="n">n_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nmin</span><span class="p">,</span><span class="n">nmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(((</span><span class="n">nrange</span><span class="p">)</span><span class="o">/</span><span class="n">nstep</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">]),</span> <span class="n">n_arr</span><span class="p">)</span>

    <span class="n">color_arr</span><span class="p">,</span> <span class="n">ls_arr</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">nextra</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_arr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">8.</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#2d0037&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_n</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="n">nextra</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nrange</span><span class="o">+</span><span class="n">nextra</span><span class="p">)))</span>
        <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n=</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n=</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1"># Load files:</span>
    <span class="n">ks_dicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_arr</span><span class="p">:</span>
        <span class="n">invq</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">q</span>
        <span class="n">ks_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;3D&#39;</span><span class="p">],</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;3D_ellip&#39;</span><span class="p">],</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">({}</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_arr</span><span class="p">:</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R_arr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;3D&#39;</span><span class="p">][</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;3D_ellip&#39;</span><span class="p">][</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;menc3D_ellipsoid&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">][</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>

        <span class="n">ks_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">)</span>


    <span class="c1"># ++++++++++++++++</span>
    <span class="c1"># plot 3D:</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(R/R_{\mathrm</span><span class="si">{e}</span><span class="s1">})$&#39;</span>
    <span class="n">types</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">vline_loc</span><span class="p">,</span> <span class="n">vline_lss</span><span class="p">,</span> <span class="n">vline_labels</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q_arr</span><span class="p">):</span>
        <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;3D&#39;</span><span class="p">)</span>
        <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$M_{\mathrm</span><span class="si">{sph}</span><span class="s1">}(&lt;r=R)/M_{\mathrm</span><span class="si">{tot}</span><span class="s1">}$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_0=</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_0=</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="n">vline_loc</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">2.2</span><span class="o">/</span><span class="mf">1.676</span><span class="p">)])</span>
        <span class="n">vline_lss</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vline_labels</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;$R=R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$R=1.3 R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vline_labels</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>

    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>
    <span class="n">ylims</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]</span>
    <span class="n">spec_pairs</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]]</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.25</span>

    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">3.5</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.155</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">n_cols</span><span class="p">,</span><span class="n">scale</span><span class="p">)</span>

    <span class="n">pad_outer</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">pad_outer</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ks_dict</span> <span class="o">=</span> <span class="n">ks_dicts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ks_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_cnt</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_arr</span><span class="p">):</span>
                <span class="n">menc_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
                <span class="k">if</span> <span class="n">menc_arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">n_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">Rarr_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R_arr&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">menc_arr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R_arr&#39;</span><span class="p">]):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Rarr_plot</span><span class="p">,</span> <span class="n">menc_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                    <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">sp_p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spec_pairs</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">sp_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                            <span class="n">wh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Rarr_plot</span> <span class="o">==</span> <span class="n">sp_p</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wh</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">menc_arr</span><span class="p">[</span><span class="n">wh</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
                                <span class="n">fracx</span> <span class="o">=</span> <span class="mf">0.015</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">q</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">):</span>
                                    <span class="n">delt</span> <span class="o">=</span> <span class="mf">0.015</span>
                                <span class="k">elif</span> <span class="p">(</span><span class="n">q</span> <span class="o">==</span> <span class="mf">0.4</span><span class="p">):</span>
                                    <span class="n">delt</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.07</span> <span class="o">-</span> <span class="mf">0.04</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_pairs</span><span class="p">)</span><span class="o">-</span><span class="n">mm</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="p">(</span><span class="n">q</span> <span class="o">==</span> <span class="mf">0.2</span><span class="p">):</span>
                                    <span class="n">delt</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.057</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_pairs</span><span class="p">)</span><span class="o">-</span><span class="n">mm</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                                <span class="n">xypos</span> <span class="o">=</span> <span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fracx</span><span class="o">*</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">menc_arr</span><span class="p">[</span><span class="n">wh</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">delt</span><span class="p">)</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">menc_arr</span><span class="p">[</span><span class="n">wh</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;\%&#39;</span><span class="p">,</span>
                                    <span class="n">xy</span><span class="o">=</span><span class="n">xypos</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
        <span class="n">delt</span> <span class="o">=</span> <span class="mf">0.015</span>
        <span class="n">fracx</span> <span class="o">=</span> <span class="mf">0.015</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;50\%&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fracx</span><span class="o">*</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">delt</span><span class="p">),</span>
            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dimgrey&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vline_loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vl</span><span class="p">,</span> <span class="n">vls</span><span class="p">,</span> <span class="n">vlb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vline_loc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">vline_lss</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">vline_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vl</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">vls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vlb</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_title</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.25</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">handles</span><span class="p">,</span> <span class="n">labels_leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
            <span class="n">neworder</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cnt</span><span class="p">)</span>
            <span class="n">handles_arr</span><span class="p">,</span> <span class="n">labels_arr</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">neworder</span><span class="p">:</span>
                <span class="n">handles_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">labels_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">neworder2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cnt</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">))</span>
            <span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">neworder2</span><span class="p">:</span>
                <span class="n">handles_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">labels_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
            <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.15</span>
            <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.25</span>

            <span class="n">legend1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr</span><span class="p">,</span> <span class="n">labels_arr</span><span class="p">,</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span>
                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>

            <span class="n">legend2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span><span class="p">,</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span>
                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 2</span>

<span class="k">def</span> <span class="nf">plot_rhalf_3D_sersic_potential</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">q_arr_plotq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]),</span>
    <span class="n">n_arr_plotn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">])):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the ratio of the 3D half mass radius to</span>
<span class="sd">    the 2D projected major axis effective radius (Reff),</span>
<span class="sd">    for a range of Sersic indices n and range of intrinsic axis ratios q.</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to directory containing the Sersic profile tables.</span>

<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;rhalf_3D_sersic_potential&#39;</span>
        <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>


    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># Arrays:</span>
    <span class="c1"># PLOTTING COLORED BY q:</span>
    <span class="n">nmin</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">nmax</span> <span class="o">=</span> <span class="mf">8.</span>
    <span class="n">nstep</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">nrange</span> <span class="o">=</span> <span class="mf">7.</span>
    <span class="n">n_arr_plotq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nmin</span><span class="p">,</span><span class="n">nmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">nmax</span><span class="o">-</span><span class="n">nmin</span><span class="p">)</span><span class="o">/</span><span class="n">nstep</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">color_arr_plotq</span><span class="p">,</span> <span class="n">ls_arr_plotq</span><span class="p">,</span> <span class="n">labels_plotq</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_arr_plotq</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">color_arr_plotq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_q</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
            <span class="n">ls_arr_plotq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_arr_plotq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmapg</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">q</span><span class="p">))</span>
            <span class="n">ls_arr_plotq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">!=</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">labels_plotq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_0=</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels_plotq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_0=</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># PLOTTING COLORED BY n:</span>
    <span class="n">nrange</span> <span class="o">=</span> <span class="mf">8.</span><span class="o">-</span><span class="mf">1.</span>
    <span class="n">q_arr_plotn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.1428</span><span class="p">,</span> <span class="mf">0.1667</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.333</span><span class="p">,</span>
                <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">])</span>

    <span class="n">color_arr_plotn</span><span class="p">,</span> <span class="n">ls_arr_plotn</span><span class="p">,</span> <span class="n">labels_plotn</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">nextra</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_arr_plotn</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">8.</span><span class="p">:</span>
            <span class="n">color_arr_plotn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#2d0037&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_arr_plotn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_n</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="n">nextra</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nrange</span><span class="o">+</span><span class="n">nextra</span><span class="p">)))</span>
        <span class="n">ls_arr_plotn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">labels_plotn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n=</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels_plotn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n=</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1">#  COMPOSITE STACK:</span>
    <span class="n">n_arrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_arr_plotq</span><span class="p">,</span> <span class="n">n_arr_plotn</span><span class="p">]</span>
    <span class="n">q_arrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">q_arr_plotq</span><span class="p">,</span> <span class="n">q_arr_plotn</span><span class="p">]</span>

    <span class="n">color_arrs</span> <span class="o">=</span>    <span class="p">[</span><span class="n">color_arr_plotq</span><span class="p">,</span> <span class="n">color_arr_plotn</span><span class="p">]</span>
    <span class="n">ls_arrs</span> <span class="o">=</span>       <span class="p">[</span><span class="n">ls_arr_plotq</span><span class="p">,</span> <span class="n">ls_arr_plotn</span><span class="p">]</span>
    <span class="n">labels_arrs</span> <span class="o">=</span>   <span class="p">[</span><span class="n">labels_plotq</span><span class="p">,</span> <span class="n">labels_plotn</span><span class="p">]</span>

    <span class="n">plot_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plotq&#39;</span><span class="p">,</span> <span class="s1">&#39;plotn&#39;</span><span class="p">]</span>

    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># Load files:</span>
    <span class="n">ks_dicts_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">plot_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plot_types</span><span class="p">):</span>
        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">q_arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">n_arr</span> <span class="o">=</span> <span class="n">n_arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ks_dicts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">arrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">q_arr</span><span class="p">,</span>
                <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">n_arr</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotq&#39;</span><span class="p">:</span>
            <span class="n">var_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotn&#39;</span><span class="p">:</span>
            <span class="n">var_order</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">[</span><span class="n">var_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
            <span class="k">if</span> <span class="n">var_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">v1</span>
            <span class="k">elif</span> <span class="n">var_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">v1</span>
            <span class="n">ks_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">rhalf3D_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="n">var_order</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="n">var_order</span><span class="p">[</span><span class="mi">1</span><span class="p">]]):</span>
                <span class="k">if</span> <span class="n">var_order</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">v2</span>
                <span class="k">elif</span> <span class="n">var_order</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">v2</span>
                <span class="n">invq</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">q</span>
                <span class="n">tab</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                <span class="n">rhalf3D_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span>
                                        <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">],</span>
                                        <span class="n">total_mass</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotq&#39;</span><span class="p">:</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;n_arr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_arr</span>
            <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotn&#39;</span><span class="p">:</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;q_arr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">q_arr</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D_arr</span>
            <span class="n">ks_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">)</span>
        <span class="c1">###</span>
        <span class="n">ks_dicts_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ks_dicts</span><span class="p">)</span>

    <span class="c1"># ++++++++++++++++</span>
    <span class="c1"># plot:</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.96</span><span class="p">,</span> <span class="mf">1.86</span><span class="p">]</span>

    <span class="n">xlim_plotq</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">8.25</span><span class="p">]</span>
    <span class="n">ylim_plotq</span> <span class="o">=</span> <span class="n">ylim</span>
    <span class="n">xlabel_plotq</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n$&#39;</span>

    <span class="n">xlim_plotn</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">2.05</span><span class="p">]</span>
    <span class="n">ylim_plotn</span> <span class="o">=</span> <span class="n">ylim</span>
    <span class="n">xlabel_plotn</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$q_0$&#39;</span>

    <span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="n">xlim_plotq</span><span class="p">,</span> <span class="n">xlim_plotn</span><span class="p">]</span>
    <span class="n">ylims</span> <span class="o">=</span> <span class="p">[</span><span class="n">ylim_plotq</span><span class="p">,</span> <span class="n">ylim_plotn</span><span class="p">]</span>
    <span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="n">xlabel_plotq</span><span class="p">,</span> <span class="n">xlabel_plotn</span><span class="p">]</span>
    <span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$r_{1/2,\, \mathrm{mass,\,3D}}/R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span><span class="p">,</span>
               <span class="sa">r</span><span class="s1">&#39;$r_{1/2,\, \mathrm{mass,\,3D}}/R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span><span class="p">]</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span>

    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">3.75</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.33</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">n_cols</span><span class="p">,</span><span class="n">scale</span><span class="o">*</span><span class="n">n_rows</span><span class="p">)</span>

    <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>

    <span class="c1">#####</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">plot_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plot_types</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>  <span class="n">ax</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ks_dicts</span> <span class="o">=</span> <span class="n">ks_dicts_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">q_arr</span> <span class="o">=</span> <span class="n">q_arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">n_arr</span> <span class="o">=</span> <span class="n">n_arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">ls_arr</span> <span class="o">=</span> <span class="n">ls_arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">color_arr</span> <span class="o">=</span> <span class="n">color_arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels_arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">xlim</span> <span class="o">=</span> <span class="n">xlims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotq&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q_arr</span><span class="p">):</span>
                <span class="n">ks_dict</span> <span class="o">=</span> <span class="n">ks_dicts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">wh_fin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wh_fin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;n_arr&#39;</span><span class="p">][</span><span class="n">wh_fin</span><span class="p">],</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D&#39;</span><span class="p">][</span><span class="n">wh_fin</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotn&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_arr</span><span class="p">):</span>
                <span class="n">ks_dict</span> <span class="o">=</span> <span class="n">ks_dicts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">wh_fin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wh_fin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;q_arr&#39;</span><span class="p">][</span><span class="n">wh_fin</span><span class="p">],</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D&#39;</span><span class="p">][</span><span class="n">wh_fin</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">ms</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
        <span class="c1">#####</span>
        <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>


        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotq&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotn&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>


        <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#True</span>
        <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
        <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.15</span>
        <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.25</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotq&#39;</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
            <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;plotn&#39;</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
            <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">)</span>

        <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
            <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor</span><span class="p">,</span>
            <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
            <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>



<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 3</span>

<span class="k">def</span> <span class="nf">plot_composite_menc_vcirc_profile_invert</span><span class="p">(</span><span class="n">q_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">n_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
            <span class="n">total_mass</span> <span class="o">=</span> <span class="mf">5.e10</span><span class="p">,</span> <span class="n">Reff</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
            <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the enclosed mass and circular velocity profiles versus radius,</span>
<span class="sd">    for a number of direct calculations and inverted assumptions</span>
<span class="sd">    (applying the relation valid for spherically symmetric cases: v^2 = GM/r ).</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to directory containing the Sersic profile tables.</span>

<span class="sd">        q_arr: array_like, optional</span>
<span class="sd">            Range of intrinsic axis ratios to plot. Default: q_arr = [1., 0.4, 0.2]</span>
<span class="sd">        n_arr: array_like, optional</span>
<span class="sd">            Range of Sersic indices to plot. Default: n_arr = [1., 4.]</span>
<span class="sd">        total_mass: float, optional</span>
<span class="sd">            Total mass of the Sersic component [Msun]. Default: 5e10 Msun</span>
<span class="sd">        Reff: float, optional</span>
<span class="sd">            Effective radius of the Sersic component [kpc]. Default: 1 kpc</span>
<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;mencl_vcirc_compsite_compare_sersic_potential&#39;</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_arr</span><span class="p">:</span>
            <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_q</span><span class="si">{:0.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_arr</span><span class="p">:</span>
            <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_n</span><span class="si">{:1.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>

    <span class="c1"># Load files:</span>
    <span class="n">ks_dicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_arr</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_arr</span><span class="p">:</span>
            <span class="c1"># read fits tables, construct ks dict.....</span>
            <span class="n">invq</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">q</span>
            <span class="n">tab_orig</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_entire_table</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">tab_orig</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">Reff</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">tab_orig</span><span class="p">,</span>
                    <span class="n">total_mass</span><span class="o">=</span><span class="n">total_mass</span><span class="p">,</span> <span class="n">Reff</span><span class="o">=</span><span class="n">Reff</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq</span><span class="p">)</span>

            <span class="n">ks_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R_arr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;menc2D_ellip&#39;</span><span class="p">]</span>  <span class="o">=</span>   <span class="n">util_calcs</span><span class="o">.</span><span class="n">total_mass2D_direct</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span>
                            <span class="n">total_mass</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">Reff</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">],</span><span class="n">i</span><span class="o">=</span><span class="mf">90.</span><span class="p">)</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">]</span>  <span class="o">=</span>     <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;menc3D_ellip&#39;</span><span class="p">]</span>  <span class="o">=</span>   <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;menc3D_ellipsoid&#39;</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>  <span class="o">=</span>          <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>

            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;v_menc3D_sph&#39;</span><span class="p">]</span> <span class="o">=</span>   <span class="n">util_calcs</span><span class="o">.</span><span class="n">vcirc_spherical_symmetry</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="n">menc</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">])</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;v_menc3D_ellip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">vcirc_spherical_symmetry</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="n">menc</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;menc3D_ellipsoid&#39;</span><span class="p">])</span>

            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;m_invert_vcirc&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">menc_spherical_symmetry</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="n">vcirc</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">])</span>

            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;mass_plot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span>

            <span class="n">ks_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">)</span>

    <span class="c1"># ++++++++++++++++</span>
    <span class="c1"># plot:</span>
    <span class="n">types1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;menc2D_ellip&#39;</span><span class="p">,</span> <span class="s1">&#39;menc3D_sph&#39;</span><span class="p">,</span> <span class="s1">&#39;menc3D_ellip&#39;</span><span class="p">,</span> <span class="s1">&#39;m_invert_vcirc&#39;</span><span class="p">]</span>
    <span class="n">ls_arr1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="n">lw_arr1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">]</span>
    <span class="n">labels1</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;2D, ellipse, Eq. 3&#39;</span><span class="p">,</span>
               <span class="sa">r</span><span class="s1">&#39;3D, sphere, Eq. 8&#39;</span><span class="p">,</span>
               <span class="sa">r</span><span class="s1">&#39;3D, spheroid, Eq. 6&#39;</span><span class="p">,</span>
               <span class="sa">r</span><span class="s1">&#39;$v_{\mathrm</span><span class="si">{circ}</span><span class="s1">}(R)^2 R/G$, Eq. 5&#39;</span><span class="p">]</span>
    <span class="n">color_arr1</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap_q</span><span class="p">(</span><span class="mf">0.18</span><span class="p">),</span> <span class="n">cmap_q</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">),</span> <span class="n">cmap_q</span><span class="p">(</span><span class="mf">5.</span><span class="o">/</span><span class="mf">9.</span><span class="p">),</span> <span class="n">cmap_q</span><span class="p">(</span><span class="mf">1.</span><span class="p">)]</span>

    <span class="n">types2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;v_menc3D_sph&#39;</span><span class="p">,</span> <span class="s1">&#39;v_menc3D_ellip&#39;</span><span class="p">,</span> <span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>
    <span class="n">ls_arr2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">]</span>
    <span class="n">lw_arr2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.35</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">]</span>
    <span class="n">labels2</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\sqrt{M_{\mathrm{3D,sph}}(&lt;r=R)G/R}$, Eq. 8&#39;</span><span class="p">,</span>
              <span class="sa">r</span><span class="s1">&#39;$\sqrt{M_{\mathrm{3D,spheroid}}(&lt;m=R)G/R}$, Eq. 6&#39;</span><span class="p">,</span>
              <span class="sa">r</span><span class="s1">&#39;$v_{\mathrm</span><span class="si">{circ}</span><span class="s1">}(R)$, Eq. 5&#39;</span><span class="p">]</span>

    <span class="n">color_arr2</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap_q</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">),</span> <span class="n">cmap_q</span><span class="p">(</span><span class="mf">5.</span><span class="o">/</span><span class="mf">9.</span><span class="p">),</span> <span class="n">cmap_q</span><span class="p">(</span><span class="mf">1.</span><span class="p">)]</span>

    <span class="n">titles1</span><span class="p">,</span> <span class="n">vline_loc1</span><span class="p">,</span> <span class="n">vline_lss1</span><span class="p">,</span> <span class="n">vline_labels1</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">xlims1</span><span class="p">,</span> <span class="n">ylims1</span><span class="p">,</span> <span class="n">xlabels1</span><span class="p">,</span> <span class="n">ylabels1</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">titles2</span><span class="p">,</span> <span class="n">vline_loc2</span><span class="p">,</span> <span class="n">vline_lss2</span><span class="p">,</span> <span class="n">vline_labels2</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">xlims2</span><span class="p">,</span> <span class="n">ylims2</span><span class="p">,</span> <span class="n">xlabels2</span><span class="p">,</span> <span class="n">ylabels2</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_arr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q_arr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">q_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)):</span>
                    <span class="n">titles1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Fractional mass profile&#39;</span><span class="p">)</span>
                    <span class="n">titles2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Circular velocity&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">titles1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="n">titles2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">titles1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">titles2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_arr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">xlabels1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(R/R_{\mathrm</span><span class="si">{e}</span><span class="s1">})$&#39;</span><span class="p">)</span>
                <span class="n">xlabels2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(R/R_{\mathrm</span><span class="si">{e}</span><span class="s1">})$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xlabels1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">xlabels2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ylabels1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$M_{\mathrm</span><span class="si">{enc}</span><span class="s1">}(&lt;R)/M_{\mathrm</span><span class="si">{total}</span><span class="s1">}$&#39;</span><span class="p">)</span>
                <span class="n">ylabels2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$v(R)\ \mathrm{[km\,s^{-1}]}$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ylabels1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">ylabels2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="n">xlims1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
            <span class="n">xlims2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
            <span class="n">ylims1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.22</span><span class="p">])</span>
            <span class="n">ylims2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">410.</span><span class="p">])</span>
            <span class="n">vline_loc1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">2.2</span><span class="o">/</span><span class="mf">1.676</span><span class="p">)])</span>
            <span class="n">vline_lss1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">])</span>
            <span class="n">vline_loc2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">2.2</span><span class="o">/</span><span class="mf">1.676</span><span class="p">)])</span>
            <span class="n">vline_lss2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="n">vline_labels1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;$R=R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$R=1.3 R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span><span class="p">])</span>
                <span class="n">vline_labels2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;$R=R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$R=1.3 R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vline_labels1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                <span class="n">vline_labels2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>


    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">3.35</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q_arr</span><span class="p">)</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_arr</span><span class="p">)</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="mf">0.98</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">n_cols</span><span class="p">,</span><span class="mf">2.</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">n_rows</span><span class="p">)</span>

    <span class="n">pad_outer</span> <span class="o">=</span> <span class="mf">0.175</span>
    <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.025</span>
    <span class="n">hspace</span> <span class="o">=</span> <span class="n">wspace</span>

    <span class="n">gs_outer</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">pad_outer</span><span class="p">)</span>
    <span class="n">gs1</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span><span class="n">n_cols</span><span class="p">,</span><span class="n">subplot_spec</span><span class="o">=</span><span class="n">gs_outer</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
    <span class="n">gs2</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span><span class="n">n_cols</span><span class="p">,</span> <span class="n">subplot_spec</span><span class="o">=</span><span class="n">gs_outer</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>

    <span class="n">axes1</span><span class="p">,</span> <span class="n">axes2</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">axes1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">axes2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">n_cols</span> <span class="o">+</span> <span class="n">j</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n_arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">q_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="n">ks_dict</span> <span class="o">=</span> <span class="n">ks_dicts</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="n">xlim1</span> <span class="o">=</span> <span class="n">xlims1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylim1</span><span class="o">=</span> <span class="n">ylims1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylabel1</span> <span class="o">=</span> <span class="n">ylabels1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">title1</span> <span class="o">=</span> <span class="n">titles1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="n">xlim2</span> <span class="o">=</span> <span class="n">xlims2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylim2</span> <span class="o">=</span> <span class="n">ylims2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylabel2</span> <span class="o">=</span> <span class="n">ylabels2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">title2</span> <span class="o">=</span> <span class="n">titles2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">ks_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">typ</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">types1</span><span class="p">):</span>
                    <span class="n">menc_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="n">types1</span><span class="p">[</span><span class="n">mm</span><span class="p">]]</span>
                    <span class="n">Rarr_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R_arr&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">])</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Rarr_plot</span><span class="p">,</span> <span class="n">menc_arr</span><span class="o">/</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;mass_plot&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr1</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr1</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                                <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr1</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels1</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">typ</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">types2</span><span class="p">):</span>
                    <span class="n">menc_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="n">types2</span><span class="p">[</span><span class="n">mm</span><span class="p">]]</span>
                    <span class="n">Rarr_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R_arr&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">])</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Rarr_plot</span><span class="p">,</span> <span class="n">menc_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr2</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr2</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                                <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr2</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels2</span><span class="p">[</span><span class="n">mm</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">ylim1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ylim1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ylim2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ylim2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

                <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;mass_plot&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;mass_plot&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">delt</span> <span class="o">=</span> <span class="mf">0.015</span>
                    <span class="n">fracx</span> <span class="o">=</span> <span class="mf">0.015</span>
                    <span class="n">yspan</span> <span class="o">=</span> <span class="n">ylim1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;50\%&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">xlim1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fracx</span><span class="o">*</span><span class="p">(</span><span class="n">xlim1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlim1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="n">delt</span><span class="p">)),</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;100\%&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">xlim1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fracx</span><span class="o">*</span><span class="p">(</span><span class="n">xlim1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xlim1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">delt</span><span class="p">)),</span>
                                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">vline_loc1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">vl</span><span class="p">,</span> <span class="n">vls</span><span class="p">,</span> <span class="n">vlb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vline_loc1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vline_lss1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vline_labels1</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vl</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">vls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vlb</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">vline_loc2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">vl</span><span class="p">,</span> <span class="n">vls</span><span class="p">,</span> <span class="n">vlb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vline_loc2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vline_lss2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">vline_labels2</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                        <span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vl</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">vls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vlb</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

            <span class="c1">######################</span>
            <span class="c1"># ANNOTATE:</span>
            <span class="c1">#######</span>
            <span class="n">posannx</span> <span class="o">=</span> <span class="mf">0.71</span>
            <span class="n">posanny</span> <span class="o">=</span> <span class="mf">0.95</span>
            <span class="n">dely</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">bbox_props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;square&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;ghostwhite&quot;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;dimgrey&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ann_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n\ \:&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$q_0=</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

            <span class="c1"># Annotate ax1:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">posannx</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">posanny</span> <span class="o">+</span> <span class="n">dely</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann_lg</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="n">bbox_props</span><span class="p">)</span>
            <span class="c1"># Annotate ax2:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">posannx</span> <span class="o">=</span> <span class="mf">0.71</span>
                <span class="n">posanny</span> <span class="o">=</span> <span class="mf">0.75</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">posannx</span><span class="p">,</span> <span class="n">posanny</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann_lg</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="n">bbox_props</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>

            <span class="c1">######################</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim1</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim1</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim2</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim2</span><span class="p">)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.25</span><span class="p">))</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.25</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">([</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]))</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FixedFormatter</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]))</span>

                <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">([</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]))</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FixedFormatter</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>

            <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">20.</span><span class="p">))</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">100.</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">xlabels1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabels1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
            <span class="k">if</span> <span class="n">ylabels1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

            <span class="k">if</span> <span class="n">xlabels2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabels2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
            <span class="k">if</span> <span class="n">ylabels2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

            <span class="k">if</span> <span class="n">titles1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_title_lg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">titles2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_title_lg</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">handles1</span><span class="p">,</span> <span class="n">labels1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="n">neworder1</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">types1</span><span class="p">))</span>
                <span class="n">handles_arr1</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr1</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder1</span><span class="p">:</span>
                    <span class="n">handles_arr1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles1</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels1</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">neworder12</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">types1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles1</span><span class="p">))</span>
                <span class="n">handles_arr12</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr12</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder12</span><span class="p">:</span>
                    <span class="n">handles_arr12</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles1</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr12</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels1</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.25</span>
                <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg_sm</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.15</span>
                <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.25</span>
                <span class="n">loc1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

                <span class="n">legend11</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr1</span><span class="p">,</span> <span class="n">labels_arr1</span><span class="p">,</span>
                    <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                    <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                    <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
                    <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span>
                    <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                <span class="n">legend12</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr12</span><span class="p">,</span> <span class="n">labels_arr12</span><span class="p">,</span>
                    <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                    <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                    <span class="n">loc</span><span class="o">=</span><span class="n">loc1</span><span class="p">,</span>
                    <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend11</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend12</span><span class="p">)</span>

                <span class="c1">#####</span>
                <span class="n">handles2</span><span class="p">,</span> <span class="n">labels2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="n">neworder2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">types2</span><span class="p">))</span>
                <span class="n">handles_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder2</span><span class="p">:</span>
                    <span class="n">handles_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles2</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels2</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">neworder2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">types2</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles2</span><span class="p">))</span>
                <span class="n">handles_arr22</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr22</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder2</span><span class="p">:</span>
                    <span class="n">handles_arr22</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles2</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr22</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels2</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">legend21</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span><span class="p">,</span>
                    <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                    <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                    <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span>
                    <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                <span class="n">legend22</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr22</span><span class="p">,</span> <span class="n">labels_arr22</span><span class="p">,</span>
                    <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                    <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                    <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span>
                    <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend21</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend22</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 4</span>

<span class="k">def</span> <span class="nf">plot_virial_coeff</span><span class="p">(</span><span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">q_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the total and 3D virial coefficients at Reff, ktot(Reff) and k3D(Reff),</span>
<span class="sd">    as a function of Sersic index n for a range of intrinsic axis ratios q.</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to directory containing the Sersic profile tables.</span>

<span class="sd">        q_arr: array_like, optional</span>
<span class="sd">            Range of intrinsic axis ratios to plot.</span>
<span class="sd">            Default: q_arr = [0.2, 0.4, 0.6, 0.8, 1., 1.5, 2.]  (mostly oblate, 2 prolate)</span>
<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;virial_coeff_sersic_potential.pdf&#39;</span>

    <span class="c1">####################</span>
    <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q_arr</span><span class="p">)</span>
    <span class="n">color_arr</span><span class="p">,</span> <span class="n">ls_arr</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_arr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_q</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmapg</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">q</span><span class="p">))</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_0=</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="c1"># Load files:</span>
    <span class="c1"># read fits tables, construct ks dict.....</span>
    <span class="n">invq</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">q</span>
    <span class="n">ks_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">],</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;3D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">({}</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">nmin</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">nmax</span> <span class="o">=</span> <span class="mf">8.</span>
    <span class="n">nstep</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">n_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nmin</span><span class="p">,</span><span class="n">nmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">nmax</span><span class="o">-</span><span class="n">nmin</span><span class="p">)</span><span class="o">/</span><span class="n">nstep</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_arr</span><span class="p">:</span>
        <span class="n">invq</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">q</span>
        <span class="n">ktot_narr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span>
        <span class="n">k3D_narr</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_arr</span><span class="p">):</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">q</span> <span class="o">==</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">):</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;narr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_arr</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;3D&#39;</span><span class="p">][</span><span class="s1">&#39;narr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_arr</span>

            <span class="n">ktot_narr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">virial_coeff_tot</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">],</span>
                            <span class="n">total_mass</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">],</span> <span class="n">vc</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;vcirc_Reff&#39;</span><span class="p">])</span>
            <span class="n">k3D_narr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>  <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">virial_coeff_3D</span><span class="p">(</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">],</span>
                            <span class="n">vc</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;vcirc_Reff&#39;</span><span class="p">],</span> <span class="n">m3D</span><span class="o">=</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;menc3D_sph_Reff&#39;</span><span class="p">])</span>

        <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;q=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ktot_narr</span>
        <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;3D&#39;</span><span class="p">][</span><span class="s1">&#39;q=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)]</span>  <span class="o">=</span> <span class="n">k3D_narr</span>


    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">,</span> <span class="s1">&#39;3D&#39;</span><span class="p">]</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n$&#39;</span>
    <span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$k_{\mathrm</span><span class="si">{tot}</span><span class="s1">}(R=R_{\mathrm</span><span class="si">{e}</span><span class="s1">})$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$k_{\mathrm</span><span class="si">{3D}</span><span class="s1">}(R=R_{\mathrm</span><span class="si">{e}</span><span class="s1">})$&#39;</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">8.25</span><span class="p">]</span>
    <span class="n">ylims</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.75</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">]]</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">ann_arr</span> <span class="o">=</span> <span class="p">[</span> <span class="sa">r</span><span class="s1">&#39;$\displaystyle k_{\mathrm</span><span class="si">{tot}</span><span class="s1">}(R_{\mathrm</span><span class="si">{e}</span><span class="s1">}) = \frac{M_{\mathrm</span><span class="si">{tot}</span><span class="s1">} G }{v_{\mathrm</span><span class="si">{circ}</span><span class="s1">}(R_{\mathrm</span><span class="si">{e}</span><span class="s1">})^2 R_{\mathrm</span><span class="si">{e}</span><span class="s1">}}$&#39;</span><span class="p">,</span>
                <span class="sa">r</span><span class="s1">&#39;$\displaystyle k_{\mathrm</span><span class="si">{3D}</span><span class="s1">}(R_{\mathrm</span><span class="si">{e}</span><span class="s1">}) = \frac{M_{\mathrm</span><span class="si">{sph}</span><span class="s1">}(&lt;r=R_{\mathrm</span><span class="si">{e}</span><span class="s1">}) G }{v_{\mathrm</span><span class="si">{circ}</span><span class="s1">}(R_{\mathrm</span><span class="si">{e}</span><span class="s1">})^2 R_{\mathrm</span><span class="si">{e}</span><span class="s1">}}$&#39;</span> <span class="p">]</span>
    <span class="n">ann_arr_pos</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;upperright&#39;</span><span class="p">,</span> <span class="s1">&#39;lowerright&#39;</span><span class="p">]</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span>

    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">3.85</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.175</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">n_cols</span><span class="p">,</span><span class="n">scale</span><span class="p">)</span>

    <span class="n">pad_outer</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">pad_outer</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q_arr</span><span class="p">):</span>
            <span class="n">k_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;q=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)]</span>
            <span class="n">n_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s1">&#39;narr&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">k_arr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_arr</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>

            <span class="k">if</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">zorder</span> <span class="o">=</span> <span class="mf">5.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zorder</span> <span class="o">=</span> <span class="mf">10.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_arr</span><span class="p">,</span> <span class="n">k_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>


        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_title</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.25</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>

        <span class="n">xydelt</span> <span class="o">=</span> <span class="mf">0.04</span>
        <span class="k">if</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lowerright&#39;</span><span class="p">:</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="n">xydelt</span><span class="p">)</span>
            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span>
            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
        <span class="k">elif</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;upperright&#39;</span><span class="p">:</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">)</span>
            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">FancyBboxPatch</span><span class="p">((</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">0.869</span><span class="p">),</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span>
                             <span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;square,pad=0.&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                             <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;dimgrey&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">,</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#False</span>
            <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
            <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.15</span>
            <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.25</span>
            <span class="n">ncol_leg</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># 1</span>
            <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                <span class="n">ncol</span><span class="o">=</span><span class="n">ncol_leg</span><span class="p">,</span>
                <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
                <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 5</span>

<span class="k">def</span> <span class="nf">plot_example_galaxy_mencl_vcirc</span><span class="p">(</span><span class="n">bt_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
             <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">z</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">Mbaryon</span><span class="o">=</span><span class="mf">6.6e10</span><span class="p">,</span>
             <span class="n">Reff_disk</span><span class="o">=</span><span class="mf">3.4</span><span class="p">,</span> <span class="n">n_disk</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">invq_disk</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span>
             <span class="n">Reff_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">n_bulge</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">invq_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
             <span class="n">Mhalo</span><span class="o">=</span><span class="mf">8.9e11</span><span class="p">,</span> <span class="n">halo_conc</span><span class="o">=</span><span class="mf">4.2</span><span class="p">,</span>
             <span class="n">rmin</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mf">15.</span><span class="p">,</span> <span class="n">rstep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
             <span class="n">log_rmin</span><span class="o">=-</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">log_rmax</span><span class="o">=</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">nlogr</span> <span class="o">=</span> <span class="mi">101</span><span class="p">,</span>
             <span class="n">logradius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">ylim_lmenc</span><span class="o">=</span><span class="p">[</span><span class="mf">8.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">],</span>
             <span class="n">ylim_lmenc_lograd</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">12.5</span><span class="p">],</span>
             <span class="n">ylim_vcirc</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">420.</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot example enclosed mass and circular velocity profiles for</span>
<span class="sd">    different mass components, over a variety of B/T ratios.</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to directory containing the Sersic profile tables.</span>

<span class="sd">        bt_arr: array_like, optional</span>
<span class="sd">            Array of B/T ratios to plot, in separate panels.</span>
<span class="sd">            Default: [0., 0.25, 0.5, 0.75]</span>
<span class="sd">        z: float, optional</span>
<span class="sd">            Redshift (to determine NFW halo properties. Default: z=2.</span>
<span class="sd">        Mbaryon: float, optional</span>
<span class="sd">            Total baryon mass [Msun]. Default: 6.6e10 Msun.</span>
<span class="sd">        Reff_disk: float, optional</span>
<span class="sd">            Sersic projected 2D half-light (assumed half-mass) radius of disk component [kpc].</span>
<span class="sd">            Default: 3.4 kpc</span>
<span class="sd">        n_disk: float, optional</span>
<span class="sd">            Sersic index of disk component. Default: n_disk = 1.</span>
<span class="sd">        invq_disk: float, optional</span>
<span class="sd">            Flattening of disk component. Default: invq_disk = 4.</span>
<span class="sd">        Reff_bulge: float, optional</span>
<span class="sd">            Sersic projected 2D half-light (assumed half-mass) radius of bulge component [kpc].</span>
<span class="sd">            Default: 1kpc</span>
<span class="sd">        n_bulge: float, optional</span>
<span class="sd">            Sersic index of bulge component. Default: n_bulge = 4.</span>
<span class="sd">        invq_bulge: float, optional</span>
<span class="sd">            Flattening of bulge component. Default: invq_bulge = 1. (spherical)</span>
<span class="sd">        Mhalo: float, optional</span>
<span class="sd">            NFW halo mass within R200 (=M200) [Msun]. Default: 8.9e112 Msun</span>
<span class="sd">        halo_conc: float, optional</span>
<span class="sd">            Concentration of NFW halo. Default: 4.2</span>

<span class="sd">        logradius: bool, optional</span>
<span class="sd">            Option whether to plot log radius or linear. Default: False (plot linear).</span>
<span class="sd">        rmin: float, optional</span>
<span class="sd">            Minimum radius, if doing linear radius. Ignored if logradius=True. [kpc]</span>
<span class="sd">        rmax: float, optional</span>
<span class="sd">            Maximum radius, if doing linear radius. Ignored if logradius=True. [kpc]</span>
<span class="sd">        rstep: float, optional</span>
<span class="sd">            Radius stepsize, if doing linear radius.Ignored if logradius=True. [kpc]</span>
<span class="sd">        log_rmin: float, optional</span>
<span class="sd">            Log of minimum radius, if doing log radius. Ignored if logradius=False. [log(kpc)]</span>
<span class="sd">        log_rmax: float, optional</span>
<span class="sd">            Log of maximum radius, if doing log radius. Ignored if logradius=False. [log(kpc)]</span>
<span class="sd">        nlogr: int, optional</span>
<span class="sd">            Number of log radius steps, if logradius=True. Ignored if logradius=False.</span>

<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;plot_example_galaxy_mencl_vcirc&#39;</span>
        <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">bt_arr</span><span class="p">:</span>
            <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_bt</span><span class="si">{:0.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logradius</span><span class="p">:</span>  <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_logradius&#39;</span>
        <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>

    <span class="k">if</span> <span class="n">logradius</span><span class="p">:</span>
        <span class="n">r_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">log_rmin</span><span class="p">,</span> <span class="n">log_rmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">nlogr</span><span class="p">)</span>
        <span class="n">Rarr_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">r_arr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="o">+</span><span class="n">rstep</span><span class="p">,</span> <span class="n">rstep</span><span class="p">)</span>
        <span class="n">Rarr_plot</span> <span class="o">=</span> <span class="n">r_arr</span>

    <span class="n">q_disk</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">invq_disk</span>

    <span class="c1"># ++++++++++++++++</span>
    <span class="c1"># plot:</span>
    <span class="n">color_fdm</span> <span class="o">=</span> <span class="s1">&#39;silver&#39;</span>
    <span class="n">color_vsq</span> <span class="o">=</span> <span class="s1">&#39;dimgrey&#39;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;menc3D&#39;</span><span class="p">,</span> <span class="s1">&#39;vcirc&#39;</span><span class="p">,</span> <span class="s1">&#39;fDM&#39;</span><span class="p">]</span>
    <span class="n">ls_arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))]</span>
    <span class="n">lw_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Disk&#39;</span><span class="p">,</span> <span class="s1">&#39;Bulge&#39;</span><span class="p">,</span> <span class="s1">&#39;Baryons&#39;</span><span class="p">,</span> <span class="s1">&#39;Halo&#39;</span><span class="p">,</span> <span class="s1">&#39;Total&#39;</span><span class="p">,</span>
                <span class="sa">r</span><span class="s1">&#39;$M_{\mathrm{enc,DM}}/M_{\mathrm{enc,tot}}$&#39;</span><span class="p">,</span>
                <span class="sa">r</span><span class="s1">&#39;$v_{\mathrm{circ,DM}}^2/v_{\mathrm{circ,tot}}^2$&#39;</span><span class="p">]</span>
    <span class="n">color_arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">color_fdm</span><span class="p">,</span> <span class="n">color_vsq</span><span class="p">]</span>

    <span class="n">titles</span><span class="p">,</span> <span class="n">xlims</span><span class="p">,</span> <span class="n">ylims</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">,</span> <span class="n">ylims2</span><span class="p">,</span> <span class="n">ylabels2</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">typ</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">types</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">bt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$B/T=</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">logradius</span><span class="p">:</span>
                    <span class="n">xlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(R/\mathrm{[kpc]})$&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R\ \mathrm{[kpc]}$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;menc3D&#39;</span><span class="p">:</span>
                    <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\mathrm</span><span class="si">{sph}</span><span class="s1">}(&lt;r=R)/M_{\odot})$&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;vcirc&#39;</span><span class="p">:</span>
                    <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$v_{\mathrm</span><span class="si">{circ}</span><span class="s1">}(R)\ \mathrm{[km\,s^{-1}]}$&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;fDM&#39;</span><span class="p">:</span>
                    <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}(R)$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ylabels2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathrm</span><span class="si">{frac}</span><span class="s1">$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ylabels2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">logradius</span><span class="p">:</span>
                <span class="n">xlims</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">log_rmin</span><span class="p">,</span> <span class="n">log_rmax</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xlims</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="o">+</span><span class="mf">0.025</span><span class="o">*</span><span class="p">(</span><span class="n">rmax</span><span class="o">-</span><span class="n">rmin</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;menc3D&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">logradius</span><span class="p">:</span>
                    <span class="n">ylims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ylim_lmenc_lograd</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ylims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ylim_lmenc</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;vcirc&#39;</span><span class="p">:</span>
                <span class="n">ylims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ylim_vcirc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;fDM&#39;</span><span class="p">:</span>
                <span class="n">ylims</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
            <span class="n">ylims2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>


    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">2.35</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">)</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.02</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">n_cols</span><span class="p">,</span><span class="n">scale</span><span class="o">*</span><span class="n">n_rows</span><span class="p">)</span>
    <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">hspace</span> <span class="o">=</span> <span class="n">wspace</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">n_cols</span> <span class="o">+</span> <span class="n">j</span>

            <span class="n">typ</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">bt_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">xlim</span> <span class="o">=</span> <span class="n">xlims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">titles</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="c1">###############</span>
            <span class="c1">## Get mass, velocity components:</span>
            <span class="n">menc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">,</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">menc_bulge</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">,</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_bulge</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_bulge</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_bulge</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">nfw</span> <span class="o">=</span> <span class="n">plot_calcs</span><span class="o">.</span><span class="n">NFW</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">Mvir</span><span class="o">=</span><span class="n">Mhalo</span><span class="p">,</span> <span class="n">conc</span><span class="o">=</span><span class="n">halo_conc</span><span class="p">)</span>
            <span class="n">menc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">enclosed_mass</span><span class="p">(</span><span class="n">r_arr</span><span class="p">)</span>
            <span class="n">menc_baryons</span> <span class="o">=</span> <span class="n">menc_disk</span> <span class="o">+</span> <span class="n">menc_bulge</span>
            <span class="n">menc_tot</span> <span class="o">=</span> <span class="n">menc_baryons</span> <span class="o">+</span> <span class="n">menc_halo</span>
            <span class="n">fdm_menc</span> <span class="o">=</span> <span class="n">menc_halo</span><span class="o">/</span><span class="n">menc_tot</span>

            <span class="n">vcirc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">,</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">vcirc_bulge</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">,</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_bulge</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_bulge</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_bulge</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">vcirc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">v_circ</span><span class="p">(</span><span class="n">r_arr</span><span class="p">)</span>
            <span class="n">vcirc_baryons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_disk</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_bulge</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">vcirc_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_baryons</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">fdm_vsq</span> <span class="o">=</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">vcirc_tot</span><span class="o">**</span><span class="mi">2</span>

            <span class="c1">#########</span>
            <span class="c1"># Get key radii:</span>
            <span class="n">r3Dhalf_disk</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_disk</span><span class="p">,</span>
                                                          <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span>
            <span class="n">r3Dhalf_bulge</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_bulge</span><span class="p">,</span>
                                                           <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span>
            <span class="n">r3Dhalf_bary</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_baryons</span><span class="p">,</span>
                                                          <span class="n">total_mass</span><span class="o">=</span><span class="n">Mbaryon</span><span class="p">)</span>

            <span class="c1"># Get fDM at these radii:</span>
            <span class="n">vcD_Redisk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">,</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">vcB_Redisk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">,</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_bulge</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_bulge</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_bulge</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">vcH_Redisk</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">v_circ</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span>
            <span class="n">fdm_vsq_Redisk</span> <span class="o">=</span> <span class="n">vcH_Redisk</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">vcD_Redisk</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcB_Redisk</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcH_Redisk</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>


            <span class="n">mencD_r3DhalfB</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r3Dhalf_bary</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">,</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">mencB_r3DhalfB</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r3Dhalf_bary</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">,</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_bulge</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_bulge</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_bulge</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">mencH_r3DhalfB</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">enclosed_mass</span><span class="p">(</span><span class="n">r3Dhalf_bary</span><span class="p">)</span>
            <span class="n">fdm_menc_r3Dhalf_bary</span> <span class="o">=</span> <span class="n">mencH_r3DhalfB</span> <span class="o">/</span> <span class="p">(</span><span class="n">mencD_r3DhalfB</span> <span class="o">+</span> <span class="n">mencB_r3DhalfB</span> <span class="o">+</span> <span class="n">mencH_r3DhalfB</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">logradius</span><span class="p">:</span>
                <span class="n">vline_loc</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">r3Dhalf_disk</span><span class="p">),</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">r3Dhalf_bulge</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">r3Dhalf_bary</span><span class="p">),</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nfw</span><span class="o">.</span><span class="n">rvir</span><span class="p">)]</span>
                <span class="n">vline_lss</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="s1">&#39;:&#39;</span><span class="p">]</span>
                <span class="n">vline_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;grey&#39;</span><span class="p">]</span>
                <span class="n">vline_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,disk}}$&#39;</span><span class="p">,</span>
                                <span class="sa">r</span><span class="s1">&#39;$r_{\mathrm{1/2,3D,disk}}$&#39;</span><span class="p">,</span>
                                <span class="sa">r</span><span class="s1">&#39;$r_{\mathrm{1/2,3D,bulge}}$&#39;</span><span class="p">,</span>
                                <span class="sa">r</span><span class="s1">&#39;$r_{\mathrm{1/2,3D,baryon}}$&#39;</span><span class="p">,</span>
                                <span class="sa">r</span><span class="s1">&#39;$r_{\mathrm</span><span class="si">{vir}</span><span class="s1">}$&#39;</span><span class="p">]</span>
                <span class="n">vline_alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">vline_loc</span> <span class="o">=</span> <span class="p">[</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">r3Dhalf_disk</span><span class="p">,</span> <span class="n">r3Dhalf_bulge</span><span class="p">,</span> <span class="n">r3Dhalf_bary</span><span class="p">]</span>
                <span class="n">vline_lss</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))]</span>
                <span class="n">vline_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">]</span>
                <span class="n">vline_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,disk}}$&#39;</span><span class="p">,</span>
                                <span class="sa">r</span><span class="s1">&#39;$r_{\mathrm{1/2,3D,disk}}$&#39;</span><span class="p">,</span>
                                <span class="sa">r</span><span class="s1">&#39;$r_{\mathrm{1/2,3D,bulge}}$&#39;</span><span class="p">,</span>
                                <span class="sa">r</span><span class="s1">&#39;$r_{\mathrm{1/2,3D,baryon}}$&#39;</span><span class="p">]</span>
                <span class="n">vline_alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>

            <span class="c1">#########</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;menc3D&#39;</span><span class="p">:</span>
                <span class="n">yarrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">menc_disk</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">menc_bulge</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">menc_baryons</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">menc_halo</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">menc_tot</span><span class="p">)]</span>
                <span class="n">asymp_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mbaryon</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mhalo</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">]</span>
                <span class="n">fdm</span> <span class="o">=</span> <span class="n">fdm_menc</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;vcirc&#39;</span><span class="p">:</span>
                <span class="n">yarrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">vcirc_disk</span><span class="p">,</span> <span class="n">vcirc_bulge</span><span class="p">,</span> <span class="n">vcirc_baryons</span><span class="p">,</span> <span class="n">vcirc_halo</span><span class="p">,</span> <span class="n">vcirc_tot</span><span class="p">]</span>
                <span class="n">fdm</span> <span class="o">=</span> <span class="n">fdm_vsq</span>

            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;fDM&#39;</span><span class="p">:</span>
                <span class="n">yarrs</span> <span class="o">=</span> <span class="p">[]</span>


            <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yarrs</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Rarr_plot</span><span class="p">,</span> <span class="n">yarrs</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">])</span>

            <span class="c1"># Plot fDM:</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;menc3D&#39;</span><span class="p">,</span> <span class="s1">&#39;vcirc&#39;</span><span class="p">]:</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;menc3D&#39;</span><span class="p">:</span>
                    <span class="n">mm</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Rarr_plot</span><span class="p">,</span> <span class="n">fdm_menc</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                            <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">10.</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;vcirc&#39;</span><span class="p">:</span>
                    <span class="n">mm</span> <span class="o">+=</span> <span class="mi">2</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Rarr_plot</span><span class="p">,</span> <span class="n">fdm_vsq</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                            <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">12.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;fDM&#39;</span><span class="p">:</span>
                <span class="n">mm</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="n">mm</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Rarr_plot</span><span class="p">,</span> <span class="n">fdm_menc</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span><span class="o">+</span><span class="mf">.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">10.</span><span class="p">)</span>
                <span class="n">mm</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Rarr_plot</span><span class="p">,</span> <span class="n">fdm_vsq</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                        <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span><span class="o">+</span><span class="mf">.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">12.</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">vl</span><span class="p">,</span> <span class="n">vls</span><span class="p">,</span> <span class="n">vlc</span><span class="p">,</span> <span class="n">vlb</span><span class="p">,</span> <span class="n">vah</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vline_loc</span><span class="p">,</span> <span class="n">vline_lss</span><span class="p">,</span> <span class="n">vline_cols</span><span class="p">,</span> <span class="n">vline_labels</span><span class="p">,</span> <span class="n">vline_alphas</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vlb</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vl</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">vls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">vlc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vlb</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">vah</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;fDM&#39;</span><span class="p">:</span>
                <span class="c1"># fdm_vsq_Redisk, fdm_menc_r3Dhalf_bary</span>
                <span class="n">fac</span> <span class="o">=</span> <span class="mf">0.8</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">fdm_vsq_Redisk</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">vline_cols</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">vline_lss</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="n">vline_alphas</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">fac</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="mi">3</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">fdm_menc_r3Dhalf_bary</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">vline_cols</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">vline_lss</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="n">vline_alphas</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">fac</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

            <span class="c1">########</span>
            <span class="k">if</span> <span class="n">ax2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylims2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_vsq</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">n_cols</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ylabels2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels_sm</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_vsq</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]))</span>
                        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FixedFormatter</span><span class="p">([</span><span class="s2">&quot;0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;0.2&quot;</span><span class="p">,</span> <span class="s2">&quot;0.4&quot;</span><span class="p">,</span> <span class="s2">&quot;0.6&quot;</span><span class="p">,</span> <span class="s2">&quot;0.8&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_vsq</span><span class="p">,</span>
                            <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks_sm</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">color_vsq</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
                    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
            <span class="c1">########</span>
            <span class="k">if</span> <span class="n">logradius</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">([</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FixedFormatter</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">]))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FixedFormatter</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;15&quot;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">5.</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;menc3D&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;vcirc&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">20.</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">100.</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;fDM&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FixedFormatter</span><span class="p">([</span><span class="s2">&quot;0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;0.2&quot;</span><span class="p">,</span> <span class="s2">&quot;0.4&quot;</span><span class="p">,</span> <span class="s2">&quot;0.6&quot;</span><span class="p">,</span> <span class="s2">&quot;0.8&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">xlabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabels</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

            <span class="k">if</span> <span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

            <span class="k">if</span> <span class="n">titles</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_title</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">i</span> <span class="o">==</span> <span class="n">n_rows</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels_leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="n">neworder</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yarrs</span><span class="p">))</span>
                <span class="n">handles_arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder</span><span class="p">:</span>
                    <span class="n">handles_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">handlesax2</span><span class="p">,</span> <span class="n">labelsax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="n">neworder2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">handlesax2</span><span class="p">))</span>
                <span class="n">handles_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder2</span><span class="p">:</span>
                    <span class="n">handles_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handlesax2</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labelsax2</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">neworder3</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">yarrs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">))</span>
                <span class="n">handles_arr3</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr3</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder3</span><span class="p">:</span>
                    <span class="n">handles_arr3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.25</span>
                <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.15</span>
                <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.25</span>
                <span class="n">loc3</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span>
                <span class="k">if</span> <span class="n">logradius</span><span class="p">:</span>
                    <span class="n">loc2</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">loc2</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span>
                    <span class="n">bbox2_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">legend1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">handles_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">labels_arr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.93</span><span class="p">,</span><span class="mf">1.02</span><span class="p">),</span>
                        <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span>
                        <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                    <span class="n">legend15</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">labels_arr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span>
                        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="o">-</span><span class="mf">0.04</span><span class="p">),</span>
                        <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.55</span><span class="p">,</span>
                        <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend15</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">i</span> <span class="o">==</span> <span class="n">n_rows</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
                    <span class="n">legend2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span><span class="p">,</span>
                        <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox2_to_anchor</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc2</span><span class="p">,</span>
                        <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">handlelength</span><span class="o">=</span><span class="mf">3.35</span><span class="p">,</span>
                        <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
                        <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">((</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
                    <span class="n">legend3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">handles_arr3</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">labels_arr3</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                        <span class="n">labelspacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.83</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">),</span>
                        <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span>
                        <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                    <span class="n">legend35</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr3</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">labels_arr3</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                        <span class="n">labelspacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                        <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span> <span class="n">loc3</span><span class="p">,</span>
                        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span>
                        <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span>
                        <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                    <span class="c1"># Hack to get alpha more to match</span>
                    <span class="k">for</span> <span class="n">lh</span><span class="p">,</span> <span class="n">alph</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">legend3</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">,</span> <span class="p">[</span><span class="n">vline_alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">]]):</span>
                        <span class="k">if</span> <span class="n">alph</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
                            <span class="n">alph</span> <span class="o">*=</span> <span class="mf">0.65</span>
                        <span class="n">lh</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alph</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">lh</span><span class="p">,</span> <span class="n">alph</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">legend35</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">,</span> <span class="n">vline_alphas</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                        <span class="k">if</span> <span class="n">alph</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
                            <span class="n">alph</span> <span class="o">*=</span> <span class="mf">0.65</span>
                        <span class="n">lh</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alph</span><span class="p">)</span>
                    <span class="c1"># Change label v alignment</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">legend35</span><span class="o">.</span><span class="n">get_texts</span><span class="p">():</span>
                        <span class="n">t</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend3</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend35</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 6</span>

<span class="k">def</span> <span class="nf">plot_fdm_calibration</span><span class="p">(</span><span class="n">Mstar_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Mbaryon_arr</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="o">**</span><span class="mf">10.5</span><span class="p">],</span>
            <span class="n">q_disk_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
            <span class="n">Mhalo_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.e12</span><span class="p">],</span> <span class="n">halo_conc_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">4.</span><span class="p">],</span>
            <span class="n">Reff_disk_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.</span><span class="p">],</span>
            <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">n_disk</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">Reff_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">n_bulge</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">invq_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
            <span class="n">del_fDM</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the calibration ratio between fDM(vcirc,Reff) / fDM(Menc,Reff)</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">        Path to directory containing the Sersic profile tables.</span>

<span class="sd">        z: float, optional</span>
<span class="sd">            Redshift (to determine NFW halo properties). Default: z=2.</span>
<span class="sd">        Mbaryon_arr: array_like, optional</span>
<span class="sd">            Array of total baryon mass to plot [Msun].</span>
<span class="sd">            Default: [10**10.5] Msun.</span>
<span class="sd">        q_disk_arr: array_like, optional</span>
<span class="sd">            Array of flattening for disk.</span>
<span class="sd">            Default: [0.01, 0.05, 0.1, 0.2, 0.25, 0.4, 0.6, 0.8, 1., 1.5, 2.]</span>
<span class="sd">        Mhalo_arr: array_like, optional</span>
<span class="sd">            Array of NFW halo masses within R200 (=M200) [Msun].</span>
<span class="sd">            Default: [1.e12] Msun.</span>
<span class="sd">        halo_conc_arr: array_like, optional</span>
<span class="sd">            Array of halo concentrations. Default: [4.]</span>
<span class="sd">        Reff_disk: array_like, optional</span>
<span class="sd">            Sersic projected 2D half-light (assumed half-mass) radius of disk component [kpc].</span>
<span class="sd">            Default: [5.] kpc</span>
<span class="sd">        n_disk: float, optional</span>
<span class="sd">            Sersic index of disk component. Default: n_disk = 1.</span>
<span class="sd">        Reff_bulge: float, optional</span>
<span class="sd">            Sersic projected 2D half-light (assumed half-mass) radius of bulge component [kpc].</span>
<span class="sd">            Default: 1kpc</span>
<span class="sd">        n_bulge:    Sersic index of bulge component. Default: n_bulge = 4.</span>
<span class="sd">        invq_bulge: Flattening of bulge componen. Default: invq_bulge = 1. (spherical)</span>

<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;plot_fdm_calibration&#39;</span>
        <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>     <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_del_fDM&#39;</span>
        <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>

    <span class="c1"># ++++++++++++++++</span>
    <span class="c1"># SETUP:</span>
    <span class="k">if</span> <span class="n">Mstar_arr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Override the other settings with &quot;typical&quot; values:</span>
        <span class="n">Mbaryon_arr</span><span class="p">,</span> <span class="n">Mhalo_arr</span><span class="p">,</span> <span class="n">halo_conc_arr</span><span class="p">,</span> <span class="n">Reff_disk_arr</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">Mstar</span> <span class="ow">in</span> <span class="n">Mstar_arr</span><span class="p">:</span>
            <span class="n">lmstar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mstar</span><span class="p">)</span>
            <span class="n">Reff_disk</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_mstar_Reff_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">,</span> <span class="n">galtype</span><span class="o">=</span><span class="s1">&#39;sf&#39;</span><span class="p">)</span>
            <span class="n">fgas</span> <span class="o">=</span>      <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_fgas_scaling_relation_MS</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">)</span>
            <span class="n">Mhalo</span> <span class="o">=</span>     <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_smhm_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">)</span>
            <span class="n">halo_conc</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_halo_conc_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmhalo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mhalo</span><span class="p">))</span>

            <span class="n">Mbaryon_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Mstar</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">fgas</span><span class="p">))</span>
            <span class="n">Mhalo_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Mhalo</span><span class="p">)</span>
            <span class="n">halo_conc_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">halo_conc</span><span class="p">)</span>
            <span class="n">Reff_disk_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span>

    <span class="c1"># ++++++++++++++++</span>
    <span class="c1"># plot:</span>
    <span class="n">btstep</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">bt_arr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="o">+</span><span class="n">btstep</span><span class="p">,</span> <span class="n">btstep</span><span class="p">)</span>
    <span class="n">q_disk_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q_disk_arr</span><span class="p">)</span>
    <span class="n">invq_disk_arr</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">q_disk_arr</span>

    <span class="n">color_arr</span><span class="p">,</span> <span class="n">ls_arr</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">lw_arr</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_disk_arr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_q</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmapg</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">q</span><span class="p">))</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">lw_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.25</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_{0,\mathrm</span><span class="si">{disk}</span><span class="s1">}&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    <span class="n">lss_bonus</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">]</span>

    <span class="n">titles</span><span class="p">,</span> <span class="n">xlims</span><span class="p">,</span> <span class="n">ylims</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">,</span> <span class="n">ylabels</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">Mbaryon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Mbaryon_arr</span><span class="p">):</span>
        <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\mathrm</span><span class="si">{baryon}</span><span class="s1">}/M_{\odot})&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mbaryon</span><span class="p">)))</span>
        <span class="n">xlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$B/T$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$[ (f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{v}</span><span class="s1">-f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{m}</span><span class="s1">)/f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{m}</span><span class="s1">](R_{\mathrm{e,disk}})$&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{v}</span><span class="s1">(R_{\mathrm{e,disk}})/f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{m}</span><span class="s1">(R_{\mathrm{e,disk}})$&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">xlims</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
            <span class="n">ylims</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylims</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.77</span><span class="p">,</span> <span class="mf">1.045</span><span class="p">])</span>

    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">4.</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Mbaryon_arr</span><span class="p">)</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.02</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">n_cols</span><span class="p">,</span><span class="n">scale</span><span class="o">*</span><span class="n">n_rows</span><span class="p">)</span>

    <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.025</span>
    <span class="n">hspace</span> <span class="o">=</span> <span class="n">wspace</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>

    <span class="c1">######################</span>
    <span class="c1"># Load bulge: n, invq don&#39;t change.</span>
    <span class="n">tab_bulge</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_bulge</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_bulge</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
    <span class="n">tab_bulge_menc</span> <span class="o">=</span>    <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_vcirc</span> <span class="o">=</span>   <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_rad</span> <span class="o">=</span>     <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_Reff</span> <span class="o">=</span>    <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_mass</span> <span class="o">=</span>    <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span>

    <span class="c1"># Clean up values inside rmin:  Add the value at r=0: menc=0</span>
    <span class="k">if</span> <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">tab_bulge_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_bulge_rad</span><span class="p">)</span>
        <span class="n">tab_bulge_menc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_bulge_menc</span><span class="p">)</span>
        <span class="n">tab_bulge_vcirc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_bulge_vcirc</span><span class="p">)</span>

    <span class="n">m_interp_bulge</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_bulge_rad</span><span class="p">,</span> <span class="n">tab_bulge_menc</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
    <span class="n">v_interp_bulge</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_bulge_rad</span><span class="p">,</span> <span class="n">tab_bulge_vcirc</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

    <span class="c1">######################</span>
    <span class="n">plot_cnt_q</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">invq_disk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">invq_disk_arr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invq_disk</span> <span class="ow">in</span> <span class="n">invq_disk_arr</span><span class="p">:</span>
            <span class="c1">## Get mass, velocity components:</span>
            <span class="c1"># FASTER:</span>
            <span class="c1">######################</span>
            <span class="n">tab_disk</span> <span class="o">=</span>  <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">tab_disk_menc</span> <span class="o">=</span>    <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">]</span>
            <span class="n">tab_disk_vcirc</span> <span class="o">=</span>   <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>
            <span class="n">tab_disk_rad</span> <span class="o">=</span>     <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
            <span class="n">tab_disk_Reff</span> <span class="o">=</span>    <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
            <span class="n">tab_disk_mass</span> <span class="o">=</span>    <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span>

            <span class="c1"># Clean up values inside rmin:  Add the value at r=0: menc=0</span>
            <span class="k">if</span> <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">tab_disk_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_disk_rad</span><span class="p">)</span>
                <span class="n">tab_disk_menc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_disk_menc</span><span class="p">)</span>
                <span class="n">tab_disk_vcirc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_disk_vcirc</span><span class="p">)</span>

            <span class="n">m_interp_disk</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_disk_rad</span><span class="p">,</span> <span class="n">tab_disk_menc</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
            <span class="n">v_interp_disk</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_disk_rad</span><span class="p">,</span> <span class="n">tab_disk_vcirc</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

            <span class="c1">######################</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">n_cols</span> <span class="o">+</span> <span class="n">j</span>

                    <span class="n">Mbaryon</span> <span class="o">=</span>   <span class="n">Mbaryon_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">Reff_disk</span> <span class="o">=</span> <span class="n">Reff_disk_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">Mhalo</span> <span class="o">=</span>     <span class="n">Mhalo_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">halo_conc</span> <span class="o">=</span> <span class="n">halo_conc_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                    <span class="n">ax</span> <span class="o">=</span>        <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">xlim</span> <span class="o">=</span>      <span class="n">xlims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">ylim</span> <span class="o">=</span>      <span class="n">ylims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">ylabel</span> <span class="o">=</span>    <span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">title</span> <span class="o">=</span>     <span class="n">titles</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                    <span class="c1">######################</span>
                    <span class="n">fdm_menc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">))</span><span class="o">*</span> <span class="o">-</span><span class="mf">99.</span>
                    <span class="n">fdm_vsq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">))</span><span class="o">*</span> <span class="o">-</span><span class="mf">99.</span>

                    <span class="k">for</span> <span class="n">ll</span><span class="p">,</span> <span class="n">bt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">):</span>
                        <span class="n">menc_disk</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_disk</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_disk</span> <span class="o">*</span> <span class="n">tab_disk_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">(((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_disk_mass</span><span class="p">)</span> <span class="p">)</span>
                        <span class="n">vcirc_disk</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_interp_disk</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_disk</span> <span class="o">*</span> <span class="n">tab_disk_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_disk_mass</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tab_disk_Reff</span> <span class="o">/</span> <span class="n">Reff_disk</span><span class="p">))</span>

                        <span class="n">menc_bulge</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_bulge</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="p">)</span>
                        <span class="n">vcirc_bulge</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_interp_bulge</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tab_bulge_Reff</span> <span class="o">/</span> <span class="n">Reff_bulge</span><span class="p">))</span>

                        <span class="n">nfw</span> <span class="o">=</span> <span class="n">plot_calcs</span><span class="o">.</span><span class="n">NFW</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">Mvir</span><span class="o">=</span><span class="n">Mhalo</span><span class="p">,</span> <span class="n">conc</span><span class="o">=</span><span class="n">halo_conc</span><span class="p">)</span>
                        <span class="n">menc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">enclosed_mass</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span>

                        <span class="n">menc_baryons</span> <span class="o">=</span> <span class="n">menc_disk</span> <span class="o">+</span> <span class="n">menc_bulge</span>
                        <span class="n">menc_tot</span> <span class="o">=</span> <span class="n">menc_baryons</span> <span class="o">+</span> <span class="n">menc_halo</span>
                        <span class="n">fdm_menc</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_halo</span><span class="o">/</span><span class="n">menc_tot</span>

                        <span class="n">vcirc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">v_circ</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span>
                        <span class="n">vcirc_baryons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_disk</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_bulge</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">vcirc_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_baryons</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">fdm_vsq</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">vcirc_tot</span><span class="o">**</span><span class="mi">2</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">mm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                            <span class="n">menc_baryons</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">total_mass2D_direct</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="n">Mbaryon</span><span class="p">,</span>
                                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
                            <span class="n">vcirc_baryons</span> <span class="o">=</span> <span class="n">plot_calcs</span><span class="o">.</span><span class="n">freeman_vcirc</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">Mbaryon</span><span class="p">,</span> <span class="n">Reff_disk</span><span class="p">)</span>

                            <span class="n">menc_tot</span> <span class="o">=</span> <span class="n">menc_baryons</span> <span class="o">+</span> <span class="n">menc_halo</span>
                            <span class="n">vcirc_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_baryons</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                            <span class="n">fdm_menc_tmp</span> <span class="o">=</span> <span class="n">menc_halo</span><span class="o">/</span><span class="n">menc_tot</span>
                            <span class="n">fdm_vsq_tmp</span> <span class="o">=</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">vcirc_tot</span><span class="o">**</span><span class="mi">2</span>

                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Freeman: fDMv/fDMm = </span><span class="si">{:0.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fdm_vsq_tmp</span><span class="o">/</span><span class="n">fdm_menc_tmp</span><span class="p">))</span>

                            <span class="c1"># # Do another limiting calc:</span>
                            <span class="c1"># qprime = 0.001</span>
                            <span class="c1"># sprof = core.DeprojSersicModel(total_mass=Mbaryon,</span>
                            <span class="c1">#                                Reff=Reff_disk, n=n_disk, q=qprime)</span>
                            <span class="c1">#</span>
                            <span class="c1"># menc_baryons = sprof.enclosed_mass(Reff_disk)</span>
                            <span class="c1"># vcirc_baryons = sprof.v_circ(Reff_disk)</span>
                            <span class="c1"># menc_tot = menc_baryons + menc_halo</span>
                            <span class="c1"># vcirc_tot = np.sqrt(vcirc_baryons**2 + vcirc_halo**2)</span>
                            <span class="c1"># fdm_menc_tmp = menc_halo/menc_tot</span>
                            <span class="c1"># fdm_vsq_tmp = vcirc_halo**2/vcirc_tot**2</span>
                            <span class="c1">#</span>
                            <span class="c1"># print(&quot;Oblate q={}: fDMv/fDMm = {:0.4f}&quot;.format(qprime, fdm_vsq_tmp/fdm_menc_tmp))</span>

                    <span class="c1">######################</span>
                    <span class="k">if</span> <span class="n">invq_disk</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">zorder</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">zorder</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="p">(</span><span class="n">fdm_vsq</span><span class="o">-</span><span class="n">fdm_menc</span><span class="p">)</span><span class="o">/</span><span class="n">fdm_menc</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">fdm_vsq</span><span class="o">/</span><span class="n">fdm_menc</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                                <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">mm</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">invq_disk_arr</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">):</span>
                                <span class="n">lbl_tmp</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\mathrm</span><span class="si">{bar}</span><span class="s1">}/M_{\odot})=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mbaryon</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lbl_tmp</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">fdm_vsq</span><span class="o">/</span><span class="n">fdm_menc</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">lss_bonus</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl_tmp</span><span class="p">)</span>

            <span class="n">plot_cnt_q</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Missing invq_disk file</span>
            <span class="k">pass</span>

    <span class="c1">####</span>
    <span class="c1"># Go back and do plot formatting:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">n_cols</span> <span class="o">+</span> <span class="n">j</span>

            <span class="n">Mbaryon</span> <span class="o">=</span>   <span class="n">Mbaryon_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">Reff_disk</span> <span class="o">=</span> <span class="n">Reff_disk_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">Mhalo</span> <span class="o">=</span>     <span class="n">Mhalo_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">halo_conc</span> <span class="o">=</span> <span class="n">halo_conc_arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="n">ax</span> <span class="o">=</span>        <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">xlim</span> <span class="o">=</span>      <span class="n">xlims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylim</span> <span class="o">=</span>      <span class="n">ylims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylabel</span> <span class="o">=</span>    <span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">title</span> <span class="o">=</span>     <span class="n">titles</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

            <span class="c1"># Annotate:</span>
            <span class="k">if</span> <span class="n">k</span>  <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">padx</span> <span class="o">=</span> <span class="n">pady</span> <span class="o">=</span> <span class="mf">0.03</span>
                <span class="n">xypos</span> <span class="o">=</span> <span class="p">(</span><span class="n">padx</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">pady</span><span class="p">)</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                <span class="n">ann_str_cnst</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,disk}}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\,\mathrm</span><span class="si">{kpc}</span><span class="s1">$&#39;</span>
                <span class="n">ann_str_cnst</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">ann_str_cnst</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$n_{\mathrm</span><span class="si">{disk}</span><span class="s1">}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_disk</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str_cnst</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xypos</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>

                <span class="n">pady</span> <span class="o">=</span> <span class="mf">0.03</span>
                <span class="n">xdelt</span> <span class="o">=</span> <span class="mf">0.35</span>
                <span class="n">ann_str_cnst</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,bulge}}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Reff_bulge</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\,\mathrm</span><span class="si">{kpc}</span><span class="s1">$&#39;</span>
                <span class="n">ann_str_cnst</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">ann_str_cnst</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$n_{\mathrm</span><span class="si">{bulge}</span><span class="s1">}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_bulge</span><span class="p">)</span>
                <span class="n">xypos</span> <span class="o">=</span> <span class="p">(</span><span class="n">padx</span> <span class="o">+</span> <span class="n">xdelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">pady</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str_cnst</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xypos</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>

                <span class="n">xdelt</span> <span class="o">=</span> <span class="mf">0.7</span>
                <span class="n">xypos</span> <span class="o">=</span> <span class="p">(</span><span class="n">padx</span> <span class="o">+</span> <span class="n">xdelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">pady</span><span class="p">)</span>
                <span class="n">ann_str_cnst</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$q_{0,\mathrm</span><span class="si">{bulge}</span><span class="s1">}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">invq_bulge</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str_cnst</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xypos</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">padx</span> <span class="o">=</span> <span class="n">pady</span> <span class="o">=</span> <span class="mf">0.05</span>
                <span class="n">xypos</span> <span class="o">=</span> <span class="p">(</span><span class="n">padx</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">pady</span><span class="p">)</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                <span class="n">ann_str_cnst</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,disk}}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\,\mathrm</span><span class="si">{kpc}</span><span class="s1">$&#39;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str_cnst</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xypos</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>

            <span class="c1">############</span>
            <span class="n">padx</span> <span class="o">=</span> <span class="mf">0.045</span>
            <span class="n">pady</span> <span class="o">=</span> <span class="mf">0.025</span>
            <span class="n">xypos</span> <span class="o">=</span> <span class="p">(</span><span class="n">padx</span><span class="p">,</span> <span class="n">pady</span><span class="p">)</span>
            <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
            <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
            <span class="n">ann_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\mathrm</span><span class="si">{bar}</span><span class="s1">}/M_{\odot})&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mbaryon</span><span class="p">))</span>
            <span class="n">ann_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">ann_str</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\mathrm</span><span class="si">{halo}</span><span class="s1">}/M_{\odot})&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mhalo</span><span class="p">))</span>
            <span class="n">ann_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">ann_str</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$\mathrm</span><span class="si">{conc}</span><span class="s1">_{\mathrm</span><span class="si">{halo}</span><span class="s1">}&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">halo_conc</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xypos</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

            <span class="c1">########</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">bt_loc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
                <span class="n">bt_loc_str</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{:0.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)</span> <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">bt_loc</span><span class="p">]</span>
                <span class="n">bt_loc_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">bt_loc</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FixedFormatter</span><span class="p">(</span><span class="n">bt_loc_str</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabels</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
            <span class="k">if</span> <span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels_leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="n">neworder</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">plot_cnt_q</span><span class="p">)</span>
                <span class="n">handles_arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder</span><span class="p">:</span>
                    <span class="n">handles_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">neworder2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">plot_cnt_q</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">))</span>
                <span class="n">handles_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder2</span><span class="p">:</span>
                    <span class="n">handles_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.25</span>
                <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.15</span>
                <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.25</span>
                <span class="n">legend1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr</span><span class="p">,</span> <span class="n">labels_arr</span><span class="p">,</span>
                    <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                    <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span>
                    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span><span class="o">-</span><span class="mf">0.02</span><span class="p">),</span>
                    <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">handlelength</span><span class="o">=</span><span class="mf">1.65</span><span class="p">,</span>
                    <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">loc2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="n">legend2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span><span class="p">,</span>
                        <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="n">loc2</span><span class="p">,</span>
                        <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 7</span>

<span class="k">def</span> <span class="nf">plot_rhalf3DReD_fdm_calibration_ReB_ReD_rhalf3D</span><span class="p">(</span><span class="n">Mbaryon</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="mf">10.5</span><span class="p">,</span>
            <span class="n">q_disk_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
            <span class="n">ReB_to_ReD_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
            <span class="n">Mhalo</span><span class="o">=</span><span class="mf">1.e12</span><span class="p">,</span> <span class="n">halo_conc</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span>
            <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">n_disk</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">n_bulge</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">invq_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">Reff_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
            <span class="n">rmin</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mf">15.</span><span class="p">,</span> <span class="n">rstep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">btstep</span> <span class="o">=</span> <span class="mf">0.025</span><span class="p">,</span>
            <span class="n">del_fDM</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the calibration ratio between fDM(vcirc,Reff) / fDM(Menc,Reff), for a range of ReB/ReD</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">        Path to directory containing the Sersic profile tables.</span>

<span class="sd">        z: float, optional</span>
<span class="sd">            Redshift (to determine NFW halo properties). Default: z=2.</span>
<span class="sd">        Mbaryon: float, optional</span>
<span class="sd">            Total baryon mass to plot [Msun].</span>
<span class="sd">            Default: 10**10.5 Msun.</span>
<span class="sd">        q_disk_arr: array_like, optional</span>
<span class="sd">            Array of flattening for disk.</span>
<span class="sd">            Default: [0.01, 0.05, 0.1, 0.2, 0.25, 0.4, 0.6, 0.8, 1., 1.5, 2.]</span>
<span class="sd">        Mhalo: float, optional</span>
<span class="sd">            NFW halo mass within R200 (=M200) [Msun].</span>
<span class="sd">            Default: 1.e12 Msun.</span>
<span class="sd">        halo_conc_arr: flat, optional</span>
<span class="sd">            Halo concentration. Default: 4.</span>
<span class="sd">        n_disk: float, optional</span>
<span class="sd">            Sersic index of disk component. Default: n_disk = 1.</span>
<span class="sd">        Reff_bulge: float, optional</span>
<span class="sd">            Sersic projected 2D half-light (assumed half-mass) radius of bulge component [kpc].</span>
<span class="sd">            Default: 1kpc</span>
<span class="sd">        n_bulge:    Sersic index of bulge component. Default: n_bulge = 4.</span>
<span class="sd">        invq_bulge: Flattening of bulge componen. Default: invq_bulge = 1. (spherical)</span>

<span class="sd">        ReB_to_ReD_arr: array_like, optional</span>
<span class="sd">            Ratio of bulge to disk effective radii.</span>
<span class="sd">            Default: [0.2, 0.5, 1.]</span>

<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;plot_rhalf3DReD_fdm_calibration_ReB_ReD_rhalf3D&#39;</span>
        <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>     <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_del_fDM&#39;</span>
        <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>

    <span class="c1"># ++++++++++++++++</span>
    <span class="c1"># plot:</span>
    <span class="n">bt_arr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="o">+</span><span class="n">btstep</span><span class="p">,</span> <span class="n">btstep</span><span class="p">)</span>
    <span class="n">q_disk_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q_disk_arr</span><span class="p">)</span>
    <span class="n">invq_disk_arr</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">q_disk_arr</span>

    <span class="n">color_arr</span><span class="p">,</span> <span class="n">ls_arr</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">lw_arr</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_disk_arr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_q</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmapg</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">q</span><span class="p">))</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">lw_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.25</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_{0,\mathrm</span><span class="si">{disk}</span><span class="s1">}&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
    <span class="n">lss_bonus</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">]</span>


    <span class="c1"># Redo LS arr:</span>
    <span class="n">ls_arr</span><span class="p">,</span> <span class="n">dashes_arr</span><span class="p">,</span> <span class="n">lw_arr</span><span class="p">,</span> <span class="n">labels_reratio</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">dashlen</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">dashlen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">dashlen</span> <span class="o">=</span> <span class="n">dashlen</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">dashlen</span> <span class="o">=</span> <span class="n">dashlen</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># reverse</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">reBtoreD</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lw_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.3</span><span class="p">)</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">dashes_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lw_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">dashes_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lw_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">dashes_arr</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dashlen</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">lblstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,bulge}}/R_{\mathrm{e,disk}}=&#39;</span>
        <span class="k">if</span> <span class="n">reBtoreD</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lblstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)</span>
        <span class="k">elif</span> <span class="mf">10.</span><span class="o">*</span><span class="n">reBtoreD</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lblstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lblstr</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)</span>
        <span class="n">labels_reratio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lblstr</span><span class="p">)</span>


    <span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$B/T$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$B/T$&#39;</span><span class="p">]</span>
    <span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$r_{\mathrm{1/2,3D,baryons}}/R_{\mathrm{e,disk}}$&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
        <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{v}</span><span class="s1">(R_{\mathrm{e,disk}})-f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{m}</span><span class="s1">(r_{1/2,\mathrm{3D,baryons}})$&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{v}</span><span class="s1">(R_{\mathrm{e,disk}})/f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{m}</span><span class="s1">(r_{1/2,\mathrm{3D,baryons}})$&#39;</span><span class="p">)</span>
    <span class="n">xlims</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]]</span>
    <span class="n">ylims</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">]]</span>
    <span class="n">ylims</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
        <span class="n">ylims</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mf">0.11</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>



    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">3.85</span> <span class="c1">#4.</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="mf">0.25</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="p">(</span><span class="n">n_cols</span><span class="o">+</span><span class="n">pad</span><span class="o">*</span><span class="p">(</span><span class="n">n_cols</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="n">scale</span><span class="o">*</span><span class="n">n_rows</span><span class="p">)</span>

    <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.22</span>
    <span class="n">hspace</span> <span class="o">=</span> <span class="n">wspace</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>

    <span class="c1">######################</span>
    <span class="c1"># Load bulge: n, invq don&#39;t change.</span>
    <span class="n">tab_bulge</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_bulge</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_bulge</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
    <span class="n">tab_bulge_menc</span> <span class="o">=</span>    <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_vcirc</span> <span class="o">=</span>   <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_rad</span> <span class="o">=</span>     <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_Reff</span> <span class="o">=</span>    <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_mass</span> <span class="o">=</span>    <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span>

    <span class="c1"># Clean up values inside rmin:  Add the value at r=0: menc=0</span>
    <span class="k">if</span> <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">tab_bulge_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_bulge_rad</span><span class="p">)</span>
        <span class="n">tab_bulge_menc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_bulge_menc</span><span class="p">)</span>
        <span class="n">tab_bulge_vcirc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_bulge_vcirc</span><span class="p">)</span>

    <span class="n">m_interp_bulge</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_bulge_rad</span><span class="p">,</span> <span class="n">tab_bulge_menc</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
    <span class="n">v_interp_bulge</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_bulge_rad</span><span class="p">,</span> <span class="n">tab_bulge_vcirc</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

    <span class="n">r_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="o">+</span><span class="n">rstep</span><span class="p">,</span> <span class="n">rstep</span><span class="p">)</span>

    <span class="c1">######################</span>
    <span class="n">plot_cnt_q</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">invq_disk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">invq_disk_arr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">invq_disk</span> <span class="ow">in</span> <span class="n">invq_disk_arr</span><span class="p">:</span>
            <span class="c1">## Get mass, velocity components:</span>
            <span class="c1"># FASTER:</span>
            <span class="c1">######################</span>
            <span class="n">tab_disk</span> <span class="o">=</span>  <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">tab_disk_menc</span> <span class="o">=</span>    <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">]</span>
            <span class="n">tab_disk_vcirc</span> <span class="o">=</span>   <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>
            <span class="n">tab_disk_rad</span> <span class="o">=</span>     <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
            <span class="n">tab_disk_Reff</span> <span class="o">=</span>    <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
            <span class="n">tab_disk_mass</span> <span class="o">=</span>    <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span>

            <span class="c1"># Clean up values inside rmin:  Add the value at r=0: menc=0</span>
            <span class="k">if</span> <span class="n">tab_disk</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">tab_disk_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_disk_rad</span><span class="p">)</span>
                <span class="n">tab_disk_menc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_disk_menc</span><span class="p">)</span>
                <span class="n">tab_disk_vcirc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_disk_vcirc</span><span class="p">)</span>

            <span class="n">m_interp_disk</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_disk_rad</span><span class="p">,</span> <span class="n">tab_disk_menc</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
            <span class="n">v_interp_disk</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_disk_rad</span><span class="p">,</span> <span class="n">tab_disk_vcirc</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>


            <span class="c1">######################</span>

            <span class="k">for</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ReBD</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">):</span>
                <span class="n">fdm_menc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">))</span><span class="o">*</span> <span class="o">-</span><span class="mf">99.</span>
                <span class="n">fdm_vsq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">))</span><span class="o">*</span> <span class="o">-</span><span class="mf">99.</span>
                <span class="n">rhalf3D_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">))</span><span class="o">*</span> <span class="o">-</span><span class="mf">99.</span>
                <span class="k">for</span> <span class="n">ll</span><span class="p">,</span> <span class="n">bt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">):</span>
                    <span class="n">Reff_disk</span> <span class="o">=</span> <span class="n">Reff_bulge</span> <span class="o">/</span> <span class="n">ReBD</span>

                    <span class="n">menc_bulge_full</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="n">bt</span><span class="p">),</span>
                        <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_bulge</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_bulge</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_bulge</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                    <span class="n">menc_disk_full</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">),</span>
                                        <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                    <span class="n">rhalf3D</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span>
                                            <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_disk_full</span><span class="o">+</span><span class="n">menc_bulge_full</span><span class="p">,</span>
                                            <span class="n">total_mass</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
                    <span class="n">rhalf3D_arr</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D</span> <span class="o">/</span> <span class="n">Reff_disk</span>

                    <span class="n">menc_disk</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_disk</span><span class="p">(</span><span class="n">rhalf3D</span> <span class="o">/</span> <span class="n">Reff_disk</span> <span class="o">*</span> <span class="n">tab_disk_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">(((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_disk_mass</span><span class="p">)</span> <span class="p">)</span>
                    <span class="n">menc_bulge</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_bulge</span><span class="p">(</span><span class="n">rhalf3D</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="p">)</span>
                    <span class="n">nfw</span> <span class="o">=</span> <span class="n">plot_calcs</span><span class="o">.</span><span class="n">NFW</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">Mvir</span><span class="o">=</span><span class="n">Mhalo</span><span class="p">,</span> <span class="n">conc</span><span class="o">=</span><span class="n">halo_conc</span><span class="p">)</span>
                    <span class="n">menc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">enclosed_mass</span><span class="p">(</span><span class="n">rhalf3D</span><span class="p">)</span>

                    <span class="n">menc_baryons</span> <span class="o">=</span> <span class="n">menc_disk</span> <span class="o">+</span> <span class="n">menc_bulge</span>
                    <span class="n">menc_tot</span> <span class="o">=</span> <span class="n">menc_baryons</span> <span class="o">+</span> <span class="n">menc_halo</span>
                    <span class="n">fdm_menc</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_halo</span><span class="o">/</span><span class="n">menc_tot</span>

                    <span class="n">vcirc_disk</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_interp_disk</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_disk</span> <span class="o">*</span> <span class="n">tab_disk_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_disk_mass</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tab_disk_Reff</span> <span class="o">/</span> <span class="n">Reff_disk</span><span class="p">))</span>
                    <span class="n">vcirc_bulge</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_interp_bulge</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tab_bulge_Reff</span> <span class="o">/</span> <span class="n">Reff_bulge</span><span class="p">))</span>
                    <span class="n">vcirc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">v_circ</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span>
                    <span class="n">vcirc_baryons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_disk</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_bulge</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">vcirc_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_baryons</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">fdm_vsq</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">vcirc_tot</span><span class="o">**</span><span class="mi">2</span>


                <span class="c1">######################</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">n_cols</span> <span class="o">+</span> <span class="n">j</span>

                        <span class="n">ax</span> <span class="o">=</span>        <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="n">xlim</span> <span class="o">=</span>      <span class="n">xlims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="n">ylim</span> <span class="o">=</span>      <span class="n">ylims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="n">ylabel</span> <span class="o">=</span>    <span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                        <span class="c1">######################</span>
                        <span class="k">if</span> <span class="n">invq_disk</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">zorder</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">zorder</span> <span class="o">=</span> <span class="kc">None</span>

                        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">lbl</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">if</span> <span class="n">dashes_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">rhalf3D_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span>
                                        <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                                        <span class="n">dashes</span><span class="o">=</span><span class="n">dashes_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">rhalf3D_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span>
                                        <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

                        <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">nn</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">lbl</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lbl</span> <span class="o">=</span> <span class="kc">None</span>

                            <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                                <span class="n">delarr</span> <span class="o">=</span><span class="p">(</span><span class="n">fdm_vsq</span><span class="o">-</span><span class="n">fdm_menc</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">dashes_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">delarr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span>
                                            <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                                            <span class="n">dashes</span><span class="o">=</span><span class="n">dashes_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">delarr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span>
                                            <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                                            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">dashes_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">fdm_vsq</span><span class="o">/</span><span class="n">fdm_menc</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                                            <span class="n">dashes</span><span class="o">=</span><span class="n">dashes_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                                            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">fdm_vsq</span><span class="o">/</span><span class="n">fdm_menc</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                                            <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

            <span class="n">plot_cnt_q</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1">####</span>
    <span class="c1"># Go back and do plot formatting:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">n_cols</span> <span class="o">+</span> <span class="n">j</span>

            <span class="n">ax</span> <span class="o">=</span>        <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">xlim</span> <span class="o">=</span>      <span class="n">xlims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylim</span> <span class="o">=</span>      <span class="n">ylims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylabel</span> <span class="o">=</span>    <span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">k</span>  <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Phandom plots for legend:</span>
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">reBD</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">):</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="n">labels_reratio</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">dashes</span> <span class="o">=</span> <span class="n">dashes_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">lw_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">ls</span> <span class="o">=</span> <span class="n">ls_arr</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span>
                    <span class="k">if</span> <span class="n">dashes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">bt_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">dashes</span><span class="o">=</span><span class="n">dashes</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">,</span> <span class="n">bt_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>

                <span class="c1"># Annotate:</span>
                <span class="n">padx</span> <span class="o">=</span> <span class="mf">0.025</span>
                <span class="n">pady</span> <span class="o">=</span> <span class="mf">0.07</span>
                <span class="n">xypos</span> <span class="o">=</span> <span class="p">(</span><span class="n">padx</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">pady</span><span class="o">-</span><span class="mf">0.125</span><span class="p">)</span>
                <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>

                <span class="n">ann_str_cnst</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n_{\mathrm</span><span class="si">{disk}</span><span class="s1">}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_disk</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str_cnst</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xypos</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>

                <span class="n">yoff</span> <span class="o">=</span> <span class="mf">0.185</span>
                <span class="n">xypos</span> <span class="o">=</span> <span class="p">(</span><span class="n">padx</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">pady</span><span class="o">-</span><span class="n">yoff</span><span class="p">)</span>


                <span class="n">ann_str_cnst</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,bulge}}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Reff_bulge</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\,\mathrm</span><span class="si">{kpc}</span><span class="s1">$&#39;</span>
                <span class="n">ann_str_cnst</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">ann_str_cnst</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$n_{\mathrm</span><span class="si">{bulge}</span><span class="s1">}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_bulge</span><span class="p">)</span>
                <span class="n">ann_str_cnst</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">ann_str_cnst</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$q_{0,\mathrm</span><span class="si">{bulge}</span><span class="s1">}=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">invq_bulge</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str_cnst</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xypos</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>


                <span class="c1">############</span>
                <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                    <span class="n">padx</span> <span class="o">=</span> <span class="mf">0.025</span>
                    <span class="n">pady</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mf">0.025</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">padx</span> <span class="o">=</span> <span class="mf">0.025</span>
                    <span class="n">pady</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="mf">0.025</span>
                    <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
                    <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                <span class="n">xypos</span> <span class="o">=</span> <span class="p">(</span><span class="n">padx</span><span class="p">,</span> <span class="n">pady</span><span class="p">)</span>
                <span class="n">ann_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\mathrm</span><span class="si">{bar}</span><span class="s1">}/M_{\odot})&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mbaryon</span><span class="p">))</span>
                <span class="n">ann_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">ann_str</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\mathrm</span><span class="si">{halo}</span><span class="s1">}/M_{\odot})&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mhalo</span><span class="p">))</span>
                <span class="n">ann_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">ann_str</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;$\mathrm</span><span class="si">{conc}</span><span class="s1">_{\mathrm</span><span class="si">{halo}</span><span class="s1">}&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;=</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">halo_conc</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xypos</span><span class="p">,</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

            <span class="c1">########</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabels</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
            <span class="k">if</span> <span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">labelpad</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">labelpad</span><span class="o">=</span><span class="kc">None</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="n">labelpad</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels_leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="n">neworder</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">plot_cnt_q</span><span class="p">)</span>
                <span class="n">handles_arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder</span><span class="p">:</span>
                    <span class="n">handles_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">neworder2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">plot_cnt_q</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">))</span>
                <span class="n">handles_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder2</span><span class="p">:</span>
                    <span class="n">handles_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.25</span>
                <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.15</span>
                <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.25</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
                <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">legend1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr</span><span class="p">,</span> <span class="n">labels_arr</span><span class="p">,</span>
                    <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                    <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor</span><span class="p">,</span>
                    <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">loc2</span> <span class="o">=</span> <span class="s1">&#39;lower left&#39;</span>
                    <span class="n">bbox_to_anchor2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
                    <span class="n">legend2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span><span class="p">,</span>
                        <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="n">loc2</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor2</span><span class="p">,</span>
                        <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                        <span class="c1">#handlelength=1.4,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 8</span>

<span class="k">def</span> <span class="nf">plot_toy_impl_fDM_calibration_z_evol</span><span class="p">(</span><span class="n">lmstar_arr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path_alt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">n_disk</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">Reff_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">n_bulge</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">invq_bulge</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
            <span class="n">del_fDM</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">save_dict_stack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">overwrite_dict_stack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">include_toy_curves</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot &quot;typical&quot; change of difference between fDM calibrations</span>
<span class="sd">    fDM(vcirc,Reff) / fDM(Menc,Reff) with redshift for SF, roughly MS galaxies,</span>
<span class="sd">    for different stellar masses.</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">        Path to directory containing the Sersic profile tables.</span>

<span class="sd">        z: float, optional</span>
<span class="sd">            Redshift (to determine NFW halo properties). Default: z=2.</span>
<span class="sd">        lmstar_arr: array_like, optional</span>
<span class="sd">            Array of the log of the total stellar mass [logMsun].</span>
<span class="sd">            Default: [9.0, 9.5, 10., 10.5, 11.] logMsun.</span>
<span class="sd">        n_disk: float, optional</span>
<span class="sd">            Sersic index of disk component. Default: n_disk = 1.</span>
<span class="sd">        Reff_bulge: float, optional</span>
<span class="sd">            Sersic projected 2D half-light (assumed half-mass) radius of bulge</span>
<span class="sd">            component [kpc].  Default: 1kpc</span>
<span class="sd">        n_bulge: float, optional</span>
<span class="sd">            Sersic index of bulge component. Default: n_bulge = 4.</span>
<span class="sd">        invq_bulge: float, optional</span>
<span class="sd">            Flattening of bulge component. Default: invq_bulge = 1. (spherical)</span>

<span class="sd">        include_toy_curves: bool, optional</span>
<span class="sd">            Include curves showing assumed interpolated / extrapolated parameters</span>
<span class="sd">            curves used to construct the toy MS model. Default: True</span>

<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;plot_toy_fdm_calibration_z_evol&#39;</span>
        <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>     <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_del_fDM&#39;</span>
        <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>

    <span class="k">if</span> <span class="n">lmstar_arr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lm_step</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="n">lmstar_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">11.</span><span class="o">+</span><span class="n">lm_step</span><span class="p">,</span> <span class="n">lm_step</span><span class="p">)</span>

    <span class="c1"># Ensure it&#39;s an np array, not a list:</span>
    <span class="n">lmstar_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lmstar_arr</span><span class="p">)</span>

    <span class="c1"># ++++++++++++++++</span>
    <span class="c1"># plot:</span>
    <span class="n">zstep</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">z_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="o">+</span><span class="n">zstep</span><span class="p">,</span> <span class="n">zstep</span><span class="p">)</span>

    <span class="n">color_arr</span><span class="p">,</span> <span class="n">ls_arr</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">lw_arr</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">lmstar</span> <span class="ow">in</span> <span class="n">lmstar_arr</span><span class="p">:</span>
        <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_mass</span><span class="p">(</span> <span class="p">(</span><span class="n">lmstar</span><span class="o">-</span><span class="n">lmstar_arr</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">lmstar_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">lmstar_arr</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">lmstar</span> <span class="o">%</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">lw_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lw_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">ls_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">lmstar</span> <span class="o">%</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{:2.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lmstar</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">lmstar</span><span class="o">*</span><span class="mf">2.</span> <span class="o">%</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{:2.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lmstar</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$</span><span class="si">{:2.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lmstar</span><span class="p">))</span>

    <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$z$&#39;</span>
    <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{v}</span><span class="s1">(R_{\mathrm{e,disk}})-f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{m}</span><span class="s1">(R_{\mathrm{e,disk}})$&#39;</span>
        <span class="n">ylim_comp</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{v}</span><span class="s1">(R_{\mathrm{e,disk}})/f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{m}</span><span class="s1">(R_{\mathrm{e,disk}})$&#39;</span>
        <span class="n">ylim_comp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">]</span>
    <span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^</span><span class="si">{v}</span><span class="s1">(R_{\mathrm{e,disk}})$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span>
               <span class="sa">r</span><span class="s1">&#39;$r_{\mathrm{1/2,3D,baryons}}/R_{\mathrm{e,disk}}$&#39;</span><span class="p">,</span>
               <span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^v(R_{\mathrm{e,disk}}) - f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^m(r_{\mathrm{1/2,3D,baryons}})$&#39;</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.01</span><span class="p">]</span>
    <span class="n">ylims</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">],</span> <span class="n">ylim_comp</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]]</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fdm_vsq&#39;</span><span class="p">,</span> <span class="s1">&#39;fDM_comp&#39;</span><span class="p">,</span>
             <span class="s1">&#39;rhalf3D_bary_to_Reff_disk&#39;</span><span class="p">,</span> <span class="s1">&#39;fDM_comp_rhalf3D_bary&#39;</span><span class="p">]</span>
    <span class="n">ann_arr_n</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">ann_arr</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\displaystyle f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^v(R_{\mathrm{e,disk}})$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\displaystyle = \frac{v_{\mathrm{circ,DM}}^2(R_{\mathrm{e,disk}})}{v_{\mathrm{circ,tot}}^2(R_{\mathrm{e,disk}})}$&#39;</span><span class="p">],</span>
                <span class="sa">r</span><span class="s1">&#39;$\displaystyle f_{\mathrm</span><span class="si">{DM}</span><span class="s1">}^m(R_{\mathrm{e,disk}}) = \frac{M_{\mathrm{DM,sph}}(&lt;r=R_{\mathrm{e,disk}})}{M_{\mathrm{tot,sph}}(&lt;r=R_{\mathrm{e,disk}})}$&#39;</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">ann_arr_pos</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;upperleft&#39;</span><span class="p">,</span> <span class="s1">&#39;upperleft&#39;</span><span class="p">],</span><span class="s1">&#39;lowerright&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">include_toy_curves</span><span class="p">:</span>
        <span class="n">keys_toy</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Reff_disk&#39;</span><span class="p">,</span> <span class="s1">&#39;invq_disk&#39;</span><span class="p">,</span> <span class="s1">&#39;fgas&#39;</span><span class="p">,</span> <span class="s1">&#39;bt&#39;</span><span class="p">,</span> <span class="s1">&#39;lMhalo&#39;</span><span class="p">,</span> <span class="s1">&#39;halo_conc&#39;</span><span class="p">]</span>
        <span class="n">ylabels_toy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ylims_toy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ylocators_toy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">keyt</span> <span class="ow">in</span> <span class="n">keys_toy</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">keyt</span> <span class="o">==</span> <span class="s1">&#39;Reff_disk&#39;</span><span class="p">:</span>
                <span class="n">ylabels_toy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,disk}}$ [kpc]&#39;</span><span class="p">)</span>
                <span class="n">ylims_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">])</span>
                <span class="n">ylocators_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">keyt</span> <span class="o">==</span> <span class="s1">&#39;invq_disk&#39;</span><span class="p">:</span>
                <span class="n">ylabels_toy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$1/q_{0,\mathrm</span><span class="si">{disk}</span><span class="s1">}$&#39;</span><span class="p">)</span>
                <span class="n">ylims_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">])</span>
                <span class="n">ylocators_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">keyt</span> <span class="o">==</span> <span class="s1">&#39;fgas&#39;</span><span class="p">:</span>
                <span class="n">ylabels_toy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f_{\mathrm</span><span class="si">{gas}</span><span class="s1">}$&#39;</span><span class="p">)</span>
                <span class="n">ylims_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
                <span class="n">ylocators_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">keyt</span> <span class="o">==</span> <span class="s1">&#39;lMbar&#39;</span><span class="p">:</span>
                <span class="n">ylabels_toy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\mathrm</span><span class="si">{bar}</span><span class="s1">}/M_{\odot})$&#39;</span><span class="p">)</span>
                <span class="n">ylims_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">8.8</span><span class="p">,</span> <span class="mf">11.6</span><span class="p">])</span>
                <span class="n">ylocators_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">keyt</span> <span class="o">==</span> <span class="s1">&#39;bt&#39;</span><span class="p">:</span>
                <span class="n">ylabels_toy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$B/T$&#39;</span><span class="p">)</span>
                <span class="n">ylims_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
                <span class="n">ylocators_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">keyt</span> <span class="o">==</span> <span class="s1">&#39;lMhalo&#39;</span><span class="p">:</span>
                <span class="n">ylabels_toy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\mathrm</span><span class="si">{halo}</span><span class="s1">}/M_{\odot})$&#39;</span><span class="p">)</span>
                <span class="n">ylims_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">10.8</span><span class="p">,</span> <span class="mf">13.2</span><span class="p">])</span>
                <span class="n">ylocators_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">keyt</span> <span class="o">==</span> <span class="s1">&#39;halo_conc&#39;</span><span class="p">:</span>
                <span class="n">ylabels_toy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c_{\mathrm</span><span class="si">{halo}</span><span class="s1">}$&#39;</span><span class="p">)</span>
                <span class="n">ylims_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">12.</span><span class="p">])</span>
                <span class="n">ylocators_toy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>

    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">2.5</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">include_toy_curves</span><span class="p">:</span>
        <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_toy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_toy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.75</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mf">1.15</span>
    <span class="n">facy</span> <span class="o">=</span> <span class="mf">1.305</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="p">(</span><span class="n">n_cols</span><span class="o">+</span><span class="p">(</span><span class="n">n_cols</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pad</span><span class="p">),</span><span class="n">facy</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="p">(</span><span class="n">n_rows</span><span class="o">+</span><span class="p">(</span><span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pad</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">include_toy_curves</span><span class="p">:</span>
        <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.125</span>
        <span class="n">hspace</span> <span class="o">=</span> <span class="n">wspace</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_toy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_toy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">height_ratios</span><span class="o">=</span> <span class="p">[</span><span class="mf">2.</span><span class="o">/</span><span class="mf">7.</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">keys_toy</span><span class="p">),</span> <span class="mf">2.</span><span class="p">]</span>

        <span class="n">gs_outer</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="n">height_ratios</span><span class="p">)</span>
        <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.45</span>
        <span class="n">hspace</span> <span class="o">=</span> <span class="n">wspace</span>
        <span class="n">gs0</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys_toy</span><span class="p">),</span><span class="n">subplot_spec</span><span class="o">=</span><span class="n">gs_outer</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span> <span class="p">)</span>
        <span class="n">axes_toy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys_toy</span><span class="p">)):</span>
                <span class="n">axes_toy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>

        <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.3</span>
        <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.175</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpecFromSubplotSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span><span class="n">subplot_spec</span><span class="o">=</span><span class="n">gs_outer</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span> <span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="n">hspace</span> <span class="o">=</span> <span class="n">wspace</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]))</span>

    <span class="c1">######################</span>
    <span class="c1"># Load bulge: n, invq don&#39;t change.</span>
    <span class="n">tab_bulge</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_bulge</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_bulge</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
    <span class="n">tab_bulge_menc</span> <span class="o">=</span>    <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;menc3D_sph&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_vcirc</span> <span class="o">=</span>   <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_rad</span> <span class="o">=</span>     <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_Reff</span> <span class="o">=</span>    <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
    <span class="n">tab_bulge_mass</span> <span class="o">=</span>    <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span>

    <span class="c1"># Clean up values inside rmin:  Add the value at r=0: menc=0</span>
    <span class="k">if</span> <span class="n">tab_bulge</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">tab_bulge_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_bulge_rad</span><span class="p">)</span>
        <span class="n">tab_bulge_menc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_bulge_menc</span><span class="p">)</span>
        <span class="n">tab_bulge_vcirc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">tab_bulge_vcirc</span><span class="p">)</span>

    <span class="n">m_interp_bulge</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_bulge_rad</span><span class="p">,</span> <span class="n">tab_bulge_menc</span><span class="p">,</span>
                                         <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
    <span class="n">v_interp_bulge</span> <span class="o">=</span> <span class="n">scp_interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">tab_bulge_rad</span><span class="p">,</span> <span class="n">tab_bulge_vcirc</span><span class="p">,</span>
                                         <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>



    <span class="n">rmin</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">rmax</span><span class="o">=</span><span class="mf">15.</span>
    <span class="n">rstep</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="n">r_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="o">+</span><span class="n">rstep</span><span class="p">,</span> <span class="n">rstep</span><span class="p">)</span>

    <span class="c1">######################</span>
    <span class="n">dict_stack</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">f_save</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;toy_impl_fDM_calibration_z&#39;</span>
    <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
        <span class="n">f_save</span> <span class="o">+=</span> <span class="s1">&#39;_delfDM&#39;</span>
    <span class="n">f_save</span> <span class="o">+=</span> <span class="s1">&#39;.pickle&#39;</span>
    <span class="k">if</span> <span class="n">save_dict_stack</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f_save</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f_save</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">dict_stack</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">overwrite_dict_stack</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deleting old file&quot;</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f_save</span><span class="p">)</span>
                <span class="n">dict_stack</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">dict_stack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dict_stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">lmstar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lmstar_arr</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lmstar=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lmstar</span><span class="p">))</span>
            <span class="n">val_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;z_arr&#39;</span><span class="p">:</span> <span class="n">z_arr</span><span class="p">,</span>
                        <span class="s1">&#39;lmstar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="n">lmstar</span><span class="p">,</span>
                        <span class="s1">&#39;bt&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;Reff_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;invq_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;invq_near&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fgas&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;lMbar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;lMhalo&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;Rvir&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;halo_conc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>

                        <span class="s1">&#39;menc_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;menc_bulge&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;menc_halo&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;menc_bar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;menc_tot&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fdm_menc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_bulge&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_halo&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_bar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_tot&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fdm_vsq&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fDM_comp&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>

                        <span class="s1">&#39;rhalf3D_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;rhalf3D_bulge&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;rhalf3D_bary&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;rhalf3D_bary_to_Reff_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fdm_menc_rhalf3D_bary&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fDM_comp_rhalf3D_bary&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span>
                        <span class="p">}</span>
            <span class="k">for</span> <span class="n">ll</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">z_arr</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  z=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="n">Reff_disk</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_mstar_Reff_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">,</span> <span class="n">galtype</span><span class="o">=</span><span class="s1">&#39;sf&#39;</span><span class="p">)</span>
                <span class="n">invq_disk</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_invq_disk_lmstar_estimate</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">)</span>
                <span class="n">fgas</span> <span class="o">=</span>      <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_fgas_scaling_relation_MS</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">)</span>
                <span class="n">Mstar</span> <span class="o">=</span>     <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">lmstar</span><span class="p">)</span>
                <span class="n">Mbaryon</span> <span class="o">=</span>   <span class="n">Mstar</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">fgas</span><span class="p">)</span>
                <span class="n">lMbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mbaryon</span><span class="p">)</span>
                <span class="n">bt</span> <span class="o">=</span>        <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_bt_lmstar_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">,</span> <span class="n">galtype</span><span class="o">=</span><span class="s1">&#39;sf&#39;</span><span class="p">)</span>
                <span class="n">Mhalo</span> <span class="o">=</span>     <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_smhm_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">)</span>
                <span class="n">lMhalo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mhalo</span><span class="p">)</span>
                <span class="n">halo_conc</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_halo_conc_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmhalo</span><span class="o">=</span><span class="n">lMhalo</span><span class="p">)</span>
                <span class="n">nfw</span> <span class="o">=</span> <span class="n">plot_calcs</span><span class="o">.</span><span class="n">NFW</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">Mvir</span><span class="o">=</span><span class="n">Mhalo</span><span class="p">,</span> <span class="n">conc</span><span class="o">=</span><span class="n">halo_conc</span><span class="p">)</span>
                <span class="n">Rvir</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">rvir</span>

                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;bt&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;Reff_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">Reff_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;invq_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">invq_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fgas&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fgas</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;lMbar&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">lMbar</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;lMhalo&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">lMhalo</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;Rvir&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rvir</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;halo_conc&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">halo_conc</span>

                <span class="c1">######</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">menc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                    <span class="n">vcirc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>

                <span class="k">except</span><span class="p">:</span>
                    <span class="n">filename_base</span> <span class="o">=</span> <span class="s1">&#39;deproj_sersic_model&#39;</span>
                    <span class="n">fname_table</span> <span class="o">=</span> <span class="n">table_path_alt</span><span class="o">+</span><span class="n">filename_base</span><span class="o">+</span><span class="s1">&#39;_n</span><span class="si">{:0.1f}</span><span class="s1">_invq</span><span class="si">{:0.2f}</span><span class="s1">.fits&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq_disk</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">menc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>
                        <span class="n">vcirc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>

                    <span class="k">except</span><span class="p">:</span>
                        <span class="c1"># Write table</span>
                        <span class="n">table_generation</span><span class="o">.</span><span class="n">calculate_sersic_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span>
                                <span class="n">output_path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span> <span class="n">fileout</span><span class="o">=</span><span class="n">fname_table</span><span class="p">,</span>
                                <span class="n">total_mass</span><span class="o">=</span><span class="mf">5.e10</span><span class="p">,</span> <span class="n">Reff</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">menc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>
                        <span class="n">vcirc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>


                <span class="n">menc_bulge</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_bulge</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">vcirc_bulge</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_interp_bulge</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tab_bulge_Reff</span> <span class="o">/</span> <span class="n">Reff_bulge</span><span class="p">))</span>

                <span class="n">nfw</span> <span class="o">=</span> <span class="n">plot_calcs</span><span class="o">.</span><span class="n">NFW</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">Mvir</span><span class="o">=</span><span class="n">Mhalo</span><span class="p">,</span> <span class="n">conc</span><span class="o">=</span><span class="n">halo_conc</span><span class="p">)</span>
                <span class="n">menc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">enclosed_mass</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span>

                <span class="n">menc_baryons</span> <span class="o">=</span> <span class="n">menc_disk</span> <span class="o">+</span> <span class="n">menc_bulge</span>
                <span class="n">menc_tot</span> <span class="o">=</span> <span class="n">menc_baryons</span> <span class="o">+</span> <span class="n">menc_halo</span>
                <span class="n">fdm_menc</span> <span class="o">=</span> <span class="n">menc_halo</span><span class="o">/</span><span class="n">menc_tot</span>

                <span class="n">vcirc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">v_circ</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span>
                <span class="n">vcirc_baryons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_disk</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_bulge</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">vcirc_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_baryons</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">fdm_vsq</span> <span class="o">=</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">vcirc_tot</span><span class="o">**</span><span class="mi">2</span>

                <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                    <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fDM_comp&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fdm_vsq</span><span class="o">-</span><span class="n">fdm_menc</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fDM_comp&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdm_vsq</span><span class="o">/</span><span class="n">fdm_menc</span>

                <span class="c1">####</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_bulge&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_bulge</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_halo&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_halo</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_bar&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_baryons</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_tot&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_tot</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fdm_menc&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdm_menc</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_bulge&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_bulge</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_halo&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_halo</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_bar&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_baryons</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_tot&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_tot</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fdm_vsq&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdm_vsq</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;invq_near&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">invq_disk</span>

                <span class="n">nearest_n</span><span class="p">,</span> <span class="n">nearest_invq</span> <span class="o">=</span> <span class="n">n_disk</span><span class="p">,</span> <span class="n">invq_disk</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">menc_disk_full</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">menc_disk_full</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>

                <span class="n">menc_bulge_full</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_bulge</span><span class="p">(</span><span class="n">r_arr</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="p">)</span>


                <span class="n">rhalf3D_disk</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span>
                                        <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_disk_full</span><span class="p">,</span>
                                        <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span>
                <span class="n">rhalf3D_bulge</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span>
                                        <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_bulge_full</span><span class="p">,</span>
                                        <span class="n">total_mass</span><span class="o">=</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span>
                <span class="n">rhalf3D_bary</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span>
                                        <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_disk_full</span><span class="o">+</span><span class="n">menc_bulge_full</span><span class="p">,</span>
                                        <span class="n">total_mass</span><span class="o">=</span><span class="n">Mbaryon</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mD_r3Db</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">rhalf3D_bary</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">mD_r3Db</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">rhalf3D_bary</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>

                <span class="n">mB_r3Db</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_bulge</span><span class="p">(</span><span class="n">rhalf3D_bary</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">mH_r3Db</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">enclosed_mass</span><span class="p">(</span><span class="n">rhalf3D_bary</span><span class="p">)</span>
                <span class="n">fdm_menc_rhalf3D_bary</span> <span class="o">=</span> <span class="n">mH_r3Db</span><span class="o">/</span><span class="p">(</span><span class="n">mD_r3Db</span><span class="o">+</span><span class="n">mB_r3Db</span><span class="o">+</span><span class="n">mH_r3Db</span><span class="p">)</span>

                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D_bulge&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D_bulge</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D_bary&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D_bary</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D_bary_to_Reff_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D_bary</span><span class="o">/</span><span class="n">Reff_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fdm_menc_rhalf3D_bary&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdm_menc_rhalf3D_bary</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fDM_comp_rhalf3D_bary&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fdm_vsq</span><span class="o">-</span><span class="n">fdm_menc_rhalf3D_bary</span><span class="p">)</span>

            <span class="c1">####</span>
            <span class="n">dict_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_dict</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">save_dict_stack</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f_save</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f_save</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict_stack</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>


    <span class="c1">########################</span>

    <span class="n">dict_toy</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">f_save_toy</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;toy_impl_fDM_calibration_z_MW_M31&#39;</span>
    <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
        <span class="n">f_save_toy</span> <span class="o">+=</span> <span class="s1">&#39;_delfDM&#39;</span>
    <span class="n">f_save_toy</span> <span class="o">+=</span> <span class="s1">&#39;.pickle&#39;</span>
    <span class="k">if</span> <span class="n">save_dict_stack</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f_save_toy</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f_save_toy</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">dict_toy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">overwrite_dict_stack</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deleting old file&quot;</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f_save_toy</span><span class="p">)</span>
                <span class="n">dict_toy</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">dict_toy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dict_toy</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ztoystep</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="n">z_arr_toy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">z_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">z_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">ztoystep</span><span class="p">,</span> <span class="n">ztoystep</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MW&#39;</span><span class="p">,</span> <span class="s1">&#39;M31&#39;</span><span class="p">]</span>
        <span class="n">ln0_arr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.4</span><span class="p">]</span>
        <span class="n">n_evol</span><span class="o">=</span><span class="s1">&#39;const&#39;</span>
        <span class="n">cmf_source</span><span class="o">=</span><span class="s1">&#39;papovich15&#39;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">ln0</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">ln0_arr</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Toy model: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
            <span class="n">val_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;z_arr&#39;</span><span class="p">:</span> <span class="n">z_arr_toy</span><span class="p">,</span>
                        <span class="s1">&#39;lmstar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span>
                        <span class="s1">&#39;bt&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;Reff_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;invq_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;invq_near&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fgas&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;lMbar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;lMhalo&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;Rvir&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;halo_conc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>

                        <span class="s1">&#39;menc_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;menc_bulge&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;menc_halo&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;menc_bar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;menc_tot&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fdm_menc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_bulge&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_halo&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_bar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;vcirc_tot&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fdm_vsq&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fDM_comp&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>

                        <span class="s1">&#39;rhalf3D_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;rhalf3D_bulge&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;rhalf3D_bary&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;rhalf3D_bary_to_Reff_disk&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fdm_menc_rhalf3D_bary&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>
                        <span class="s1">&#39;fDM_comp_rhalf3D_bary&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">))</span> <span class="o">*</span> <span class="o">-</span><span class="mf">99.</span><span class="p">,</span>

                        <span class="s1">&#39;n_evol&#39;</span><span class="p">:</span> <span class="n">n_evol</span><span class="p">,</span>
                        <span class="s1">&#39;cmf_source&#39;</span><span class="p">:</span> <span class="n">cmf_source</span><span class="p">,</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="p">}</span>
            <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;lmstar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_mass_progenitor_num_density</span><span class="p">(</span><span class="n">ln0</span><span class="p">,</span> <span class="n">z_arr_toy</span><span class="p">,</span>
                        <span class="n">n_evol</span><span class="o">=</span><span class="n">n_evol</span><span class="p">,</span> <span class="n">cmf_source</span><span class="o">=</span><span class="n">cmf_source</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ll</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">z_arr_toy</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  z=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="n">lmstar</span> <span class="o">=</span> <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;lmstar&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span>
                <span class="n">Reff_disk</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_mstar_Reff_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">,</span> <span class="n">galtype</span><span class="o">=</span><span class="s1">&#39;sf&#39;</span><span class="p">)</span>
                <span class="n">invq_disk</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_invq_disk_lmstar_estimate</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">)</span>
                <span class="n">fgas</span> <span class="o">=</span>      <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_fgas_scaling_relation_MS</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">)</span>
                <span class="n">Mstar</span> <span class="o">=</span>     <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span> <span class="n">lmstar</span><span class="p">)</span>
                <span class="n">Mbaryon</span> <span class="o">=</span>   <span class="n">Mstar</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">fgas</span><span class="p">)</span>
                <span class="n">lMbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mbaryon</span><span class="p">)</span>
                <span class="n">bt</span> <span class="o">=</span>        <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_bt_lmstar_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">,</span> <span class="n">galtype</span><span class="o">=</span><span class="s1">&#39;sf&#39;</span><span class="p">)</span>
                <span class="n">Mhalo</span> <span class="o">=</span>     <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_smhm_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmstar</span><span class="o">=</span><span class="n">lmstar</span><span class="p">)</span>
                <span class="n">lMhalo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Mhalo</span><span class="p">)</span>
                <span class="n">halo_conc</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_halo_conc_relation</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">lmhalo</span><span class="o">=</span><span class="n">lMhalo</span><span class="p">)</span>
                <span class="n">nfw</span> <span class="o">=</span> <span class="n">plot_calcs</span><span class="o">.</span><span class="n">NFW</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">Mvir</span><span class="o">=</span><span class="n">Mhalo</span><span class="p">,</span> <span class="n">conc</span><span class="o">=</span><span class="n">halo_conc</span><span class="p">)</span>
                <span class="n">Rvir</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">rvir</span>

                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;bt&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">bt</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;Reff_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">Reff_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;invq_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">invq_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fgas&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fgas</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;lMbar&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">lMbar</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;lMhalo&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">lMhalo</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;Rvir&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rvir</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;halo_conc&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">halo_conc</span>

                <span class="c1">######</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">menc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                    <span class="n">vcirc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">filename_base</span> <span class="o">=</span> <span class="s1">&#39;deproj_sersic_model&#39;</span>
                    <span class="n">fname_table</span> <span class="o">=</span> <span class="n">table_path_alt</span><span class="o">+</span><span class="n">filename_base</span><span class="o">+</span><span class="s1">&#39;_n</span><span class="si">{:0.1f}</span><span class="s1">_invq</span><span class="si">{:0.2f}</span><span class="s1">.fits&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq_disk</span><span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">menc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>
                        <span class="n">vcirc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>

                    <span class="k">except</span><span class="p">:</span>
                        <span class="c1"># Write table</span>
                        <span class="n">table_generation</span><span class="o">.</span><span class="n">calculate_sersic_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span>
                                <span class="n">output_path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span> <span class="n">fileout</span><span class="o">=</span><span class="n">fname_table</span><span class="p">,</span>
                                <span class="n">total_mass</span><span class="o">=</span><span class="mf">5.e10</span><span class="p">,</span> <span class="n">Reff</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">menc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>
                        <span class="n">vcirc_disk</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                    <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">,</span>
                                    <span class="n">filename</span><span class="o">=</span><span class="n">fname_table</span><span class="p">)</span>


                <span class="n">menc_bulge</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_bulge</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">vcirc_bulge</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_interp_bulge</span><span class="p">(</span><span class="n">Reff_disk</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tab_bulge_Reff</span> <span class="o">/</span> <span class="n">Reff_bulge</span><span class="p">))</span>

                <span class="n">nfw</span> <span class="o">=</span> <span class="n">plot_calcs</span><span class="o">.</span><span class="n">NFW</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">Mvir</span><span class="o">=</span><span class="n">Mhalo</span><span class="p">,</span> <span class="n">conc</span><span class="o">=</span><span class="n">halo_conc</span><span class="p">)</span>
                <span class="n">menc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">enclosed_mass</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span>
                <span class="n">vcirc_halo</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">v_circ</span><span class="p">(</span><span class="n">Reff_disk</span><span class="p">)</span>

                <span class="n">menc_baryons</span> <span class="o">=</span> <span class="n">menc_disk</span> <span class="o">+</span> <span class="n">menc_bulge</span>
                <span class="n">menc_tot</span> <span class="o">=</span> <span class="n">menc_baryons</span> <span class="o">+</span> <span class="n">menc_halo</span>
                <span class="n">fdm_menc</span> <span class="o">=</span> <span class="n">menc_halo</span><span class="o">/</span><span class="n">menc_tot</span>

                <span class="n">vcirc_baryons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_disk</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_bulge</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">vcirc_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc_baryons</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">fdm_vsq</span> <span class="o">=</span> <span class="n">vcirc_halo</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">vcirc_tot</span><span class="o">**</span><span class="mi">2</span>

                <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                    <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fDM_comp&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fdm_vsq</span><span class="o">-</span><span class="n">fdm_menc</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fDM_comp&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdm_vsq</span><span class="o">/</span><span class="n">fdm_menc</span>

                <span class="c1">####</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_bulge&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_bulge</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_halo&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_halo</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_bar&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_baryons</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;menc_tot&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">menc_tot</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fdm_menc&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdm_menc</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_bulge&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_bulge</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_halo&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_halo</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_bar&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_baryons</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;vcirc_tot&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">vcirc_tot</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fdm_vsq&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdm_vsq</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;invq_near&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">invq_disk</span>

                <span class="n">nearest_n</span><span class="p">,</span> <span class="n">nearest_invq</span> <span class="o">=</span> <span class="n">n_disk</span><span class="p">,</span> <span class="n">invq_disk</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">menc_disk_full</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">menc_disk_full</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">)</span>

                <span class="n">menc_bulge_full</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_bulge</span><span class="p">(</span><span class="n">r_arr</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="p">)</span>


                <span class="n">rhalf3D_disk</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span>
                                        <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_disk_full</span><span class="p">,</span>
                                        <span class="n">total_mass</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span>
                <span class="n">rhalf3D_bulge</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span>
                                        <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_bulge_full</span><span class="p">,</span>
                                        <span class="n">total_mass</span><span class="o">=</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span>
                <span class="n">rhalf3D_bary</span> <span class="o">=</span> <span class="n">util_calcs</span><span class="o">.</span><span class="n">find_rhalf3D_sphere</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span>
                                        <span class="n">menc3D_sph</span><span class="o">=</span><span class="n">menc_disk_full</span><span class="o">+</span><span class="n">menc_bulge_full</span><span class="p">,</span>
                                        <span class="n">total_mass</span><span class="o">=</span><span class="n">Mbaryon</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mD_r3Db</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">rhalf3D_bary</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">mD_r3Db</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_menc</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">rhalf3D_bary</span><span class="p">,</span> <span class="n">total_mass</span><span class="o">=</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">)</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">),</span>
                                <span class="n">Reff</span><span class="o">=</span><span class="n">Reff_disk</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n_disk</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path_alt</span><span class="p">)</span>

                <span class="n">mB_r3Db</span> <span class="o">=</span> <span class="p">(</span><span class="n">m_interp_bulge</span><span class="p">(</span><span class="n">rhalf3D_bary</span> <span class="o">/</span> <span class="n">Reff_bulge</span> <span class="o">*</span> <span class="n">tab_bulge_Reff</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">bt</span><span class="o">*</span><span class="n">Mbaryon</span><span class="p">)</span> <span class="o">/</span> <span class="n">tab_bulge_mass</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">mH_r3Db</span> <span class="o">=</span> <span class="n">nfw</span><span class="o">.</span><span class="n">enclosed_mass</span><span class="p">(</span><span class="n">rhalf3D_bary</span><span class="p">)</span>
                <span class="n">fdm_menc_rhalf3D_bary</span> <span class="o">=</span> <span class="n">mH_r3Db</span><span class="o">/</span><span class="p">(</span><span class="n">mD_r3Db</span><span class="o">+</span><span class="n">mB_r3Db</span><span class="o">+</span><span class="n">mH_r3Db</span><span class="p">)</span>

                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D_bulge&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D_bulge</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D_bary&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D_bary</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;rhalf3D_bary_to_Reff_disk&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhalf3D_bary</span><span class="o">/</span><span class="n">Reff_disk</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fdm_menc_rhalf3D_bary&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdm_menc_rhalf3D_bary</span>
                <span class="n">val_dict</span><span class="p">[</span><span class="s1">&#39;fDM_comp_rhalf3D_bary&#39;</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fdm_vsq</span><span class="o">-</span><span class="n">fdm_menc_rhalf3D_bary</span><span class="p">)</span>

            <span class="c1">####</span>
            <span class="n">dict_toy</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_dict</span>

    <span class="k">if</span> <span class="n">save_dict_stack</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">f_save_toy</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f_save_toy</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict_toy</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="c1">######################</span>
    <span class="c1"># FOR TOY PLOTS</span>
    <span class="k">if</span> <span class="n">include_toy_curves</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys_toy</span><span class="p">)):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">n_cols</span> <span class="o">+</span> <span class="n">j</span>

                <span class="n">ax</span> <span class="o">=</span> <span class="n">axes_toy</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">keyy</span> <span class="o">=</span> <span class="n">keys_toy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylims_toy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabels_toy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

                <span class="n">plot_cnt_lmstar</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">lmstar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lmstar_arr</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dict_stack</span><span class="p">[</span><span class="n">mm</span><span class="p">][</span><span class="s1">&#39;z_arr&#39;</span><span class="p">],</span> <span class="n">dict_stack</span><span class="p">[</span><span class="n">mm</span><span class="p">][</span><span class="n">keyy</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                               <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                               <span class="n">zorder</span><span class="o">=-</span><span class="mf">1.</span><span class="p">)</span>

                    <span class="n">plot_cnt_lmstar</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span><span class="n">zord</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;MW&#39;</span><span class="p">,</span> <span class="s1">&#39;M31&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;grey&#39;</span><span class="p">],</span>
                                            <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">]):</span>
                    <span class="n">whshow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">dict_toy</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;z_arr&#39;</span><span class="p">])</span><span class="o">%</span><span class="mf">0.25</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dict_toy</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;z_arr&#39;</span><span class="p">][</span><span class="n">whshow</span><span class="p">],</span> <span class="n">dict_toy</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">keyy</span><span class="p">][</span><span class="n">whshow</span><span class="p">],</span>
                               <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                               <span class="n">marker</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="n">zord</span><span class="p">)</span>

                <span class="c1">######################</span>
                <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">ylocators_toy</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="n">ylocators_toy</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

                <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels_sm</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels_sm</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks_sm</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1">######################</span>
    <span class="c1"># FOR JUST THE fDM PLOTS!</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">n_cols</span> <span class="o">+</span> <span class="n">j</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">keyy</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylims</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="n">plot_cnt_lmstar</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">mm</span><span class="p">,</span> <span class="n">lmstar</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lmstar_arr</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dict_stack</span><span class="p">[</span><span class="n">mm</span><span class="p">][</span><span class="s1">&#39;z_arr&#39;</span><span class="p">],</span> <span class="n">dict_stack</span><span class="p">[</span><span class="n">mm</span><span class="p">][</span><span class="n">keyy</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw_arr</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">mm</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">plot_cnt_lmstar</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#####################</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span><span class="n">zord</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;MW&#39;</span><span class="p">,</span> <span class="s1">&#39;M31&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;grey&#39;</span><span class="p">],</span>
                                        <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">]):</span>
                <span class="n">whshow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(((</span><span class="n">dict_toy</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;z_arr&#39;</span><span class="p">])</span><span class="o">%</span><span class="mf">0.25</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dict_toy</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;z_arr&#39;</span><span class="p">][</span><span class="n">whshow</span><span class="p">],</span> <span class="n">dict_toy</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">keyy</span><span class="p">][</span><span class="n">whshow</span><span class="p">],</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span>
                           <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="n">zord</span><span class="p">)</span>

            <span class="c1">######################</span>
            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">keyy</span> <span class="o">==</span> <span class="s1">&#39;fDM_comp&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">keyy</span> <span class="o">==</span> <span class="s1">&#39;fDM_comp_rhalf3D_bary&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">keyy</span> <span class="o">==</span> <span class="s1">&#39;rhalf3D_bary_to_Reff_disk&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ann_arr_n</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xydelt</span> <span class="o">=</span> <span class="mf">0.04</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ann_arr_n</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lowerright&#39;</span><span class="p">:</span>
                        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="n">xydelt</span><span class="p">)</span>
                        <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span>
                        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
                    <span class="k">elif</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;upperright&#39;</span><span class="p">:</span>
                        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">)</span>
                        <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
                        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
                    <span class="k">elif</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;upperleft&#39;</span><span class="p">:</span>
                        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">xydelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">)</span>
                        <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
                        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_arr</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                            <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
                            <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ann_arr_n</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lowerright&#39;</span><span class="p">:</span>
                            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="n">xydelt</span><span class="p">)</span>
                            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span>
                            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
                        <span class="k">elif</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;upperright&#39;</span><span class="p">:</span>
                            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">)</span>
                            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
                            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
                        <span class="k">elif</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">mm</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;upperleft&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">mm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                                <span class="n">xdelt</span> <span class="o">=</span> <span class="n">xydelt</span> <span class="o">*</span> <span class="mf">2.</span>
                                <span class="n">ydelt</span> <span class="o">=</span> <span class="n">xydelt</span> <span class="o">+</span> <span class="mf">0.065</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">xdelt</span> <span class="o">=</span> <span class="n">ydelt</span> <span class="o">=</span> <span class="n">xydelt</span>
                            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">ydelt</span><span class="p">)</span>
                            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
                            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_arr</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">mm</span><span class="p">],</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                                <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span>
                                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">keyy</span> <span class="o">==</span> <span class="s1">&#39;fDM_comp&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">del_fDM</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.005</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">keyy</span> <span class="o">==</span> <span class="s1">&#39;fDM_comp_rhalf3D_bary&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">keyy</span> <span class="o">==</span> <span class="s1">&#39;rhalf3D_bary_to_Reff_disk&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.05</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

            <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">handles</span><span class="p">,</span> <span class="n">labels_leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
                <span class="n">neworder</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">plot_cnt_lmstar</span><span class="p">)</span>
                <span class="n">handles_arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder</span><span class="p">:</span>
                    <span class="n">handles_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">neworder2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">plot_cnt_lmstar</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">))</span>
                <span class="n">handles_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">labels_arr2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder2</span><span class="p">:</span>
                    <span class="n">handles_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                    <span class="n">labels_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

                <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
                <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.25</span>
                <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.15</span>
                <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.25</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span>
                <span class="n">leg_title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">(M_{\star}/M_{\odot})=$&#39;</span>
                <span class="n">fontsize_leg_title</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
                <span class="n">legend1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr</span><span class="p">,</span> <span class="n">labels_arr</span><span class="p">,</span>
                    <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                    <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                    <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span>
                    <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="n">leg_title</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="n">fontsize_leg_title</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>


                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">legend2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span><span class="p">,</span>
                        <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span>
                        <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span>
                        <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>




<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 9</span>

<span class="k">def</span> <span class="nf">plot_alpha_vs_R</span><span class="p">(</span><span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">n_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">8.</span><span class="p">],</span> <span class="n">show_literature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_values</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot alpha=-dlnrho_g/dlnr derived for deprojected Sersic distribution,</span>
<span class="sd">    over a range of Sersic index n.</span>
<span class="sd">    Compare to self-gravitating exponential disk case (eg Burkert+10).</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to directory containing the Sersic profile tables.</span>

<span class="sd">        n_arr: array_like, optional</span>
<span class="sd">            Range of Sersic indices to plot. Default: n_arr = [0.5, 1., 2., 4,, 8.]</span>
<span class="sd">        show_literature: bool, optional</span>
<span class="sd">            Whether to show inferred alpha values from some simulation literature work:</span>
<span class="sd">                Kretschmer et al., 2021, MNRAS, 503, 5238-5253;</span>
<span class="sd">                Dalcanton &amp; Stilp, 2010, ApJ, 721, 547</span>
<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;alpha_vs_r_sersic_potential&#39;</span>
        <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>

    <span class="c1">####################</span>
    <span class="n">n_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">n_arr</span><span class="p">)</span>

    <span class="n">color_arr</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">nextra</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
    <span class="n">nrange</span> <span class="o">=</span> <span class="mf">7.</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_arr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">8.</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#2d0037&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_n</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="n">nextra</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nrange</span><span class="o">+</span><span class="n">nextra</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n=</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n=</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="n">q_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]</span>
    <span class="c1"># Load files:</span>
    <span class="n">ks_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">invq</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_arr</span><span class="p">):</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">][</span><span class="s1">&#39;narr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_arr</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>

        <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">][</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tab</span><span class="p">[</span><span class="s1">&#39;dlnrho_dlnR&#39;</span><span class="p">]</span>

    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha_by_sg&#39;</span><span class="p">]</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R/R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span>
    <span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\alpha(R)$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\alpha/\alpha_{\mathrm{self-grav}}(R)$&#39;</span><span class="p">]</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">]</span>
    <span class="n">ylims</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]]</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">ann_arr</span> <span class="o">=</span> <span class="p">[</span> <span class="sa">r</span><span class="s1">&#39;$\displaystyle \alpha(R) = -\frac{\mathrm</span><span class="si">{d}</span><span class="s1">\ln \rho_g}{\mathrm</span><span class="si">{d}</span><span class="s1">\ln</span><span class="si">{}</span><span class="s1">R}$&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">ann_arr_pos</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lowerright&#39;</span><span class="p">,</span> <span class="s1">&#39;lowerright&#39;</span><span class="p">]</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span>
    <span class="n">ls_arr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">show_literature</span><span class="p">:</span>
        <span class="n">lit_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">del_RtoRe</span> <span class="o">=</span> <span class="mf">0.01</span>

        <span class="c1">#####</span>
        <span class="c1"># Eq A.5, Bouche+21 // from Dalcanton &amp; Stilp 2010, Eq 17 (exponential)</span>
        <span class="n">RtoRe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">5.</span><span class="o">+</span><span class="n">del_RtoRe</span><span class="p">,</span><span class="n">del_RtoRe</span><span class="p">)</span>
        <span class="n">lit_dict</span><span class="p">[</span><span class="s1">&#39;DS10_ISM_P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">:</span> <span class="n">RtoRe</span><span class="p">,</span>
                              <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_dalcanton_stilp10_alpha_n</span><span class="p">(</span><span class="n">RtoRe</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
                              <span class="s1">&#39;ls&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span>
                              <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;Dalcanton \&amp; Stilp 2010, Eq. 17, exp.&#39;</span><span class="p">}</span>

        <span class="c1">#####</span>
        <span class="c1"># Kretschmer+21, Figure 4 alpha_rho (medians from data from M. Kretschmer)</span>
        <span class="n">k21_fig4</span> <span class="o">=</span> <span class="n">scaling_rel</span><span class="o">.</span><span class="n">_kretschmer21_fig4_alpharho</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">output_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_values</span><span class="p">:</span>
            <span class="n">nser_50</span> <span class="o">=</span> <span class="n">k21_fig4</span><span class="p">[</span><span class="s1">&#39;n_sersic&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nser_16</span> <span class="o">=</span> <span class="n">nser_50</span> <span class="o">-</span> <span class="n">k21_fig4</span><span class="p">[</span><span class="s1">&#39;n_sersic_err_l68&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nser_84</span> <span class="o">=</span> <span class="n">k21_fig4</span><span class="p">[</span><span class="s1">&#39;n_sersic_err_u68&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">nser_50</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;K21: n_sersic: median=</span><span class="si">{:0.2f}</span><span class="s2">, 16,84</span><span class="si">% r</span><span class="s2">ange=[</span><span class="si">{:0.2f}</span><span class="s2">,</span><span class="si">{:0.2f}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nser_50</span><span class="p">,</span>
                  <span class="n">nser_16</span><span class="p">,</span> <span class="n">nser_84</span><span class="p">))</span>
        <span class="n">lit_dict</span><span class="p">[</span><span class="s1">&#39;K21_fig4_alpharho&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                              <span class="s1">&#39;RtoRe&#39;</span><span class="p">:</span> <span class="n">k21_fig4</span><span class="p">[</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                              <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">k21_fig4</span><span class="p">[</span><span class="s1">&#39;alpha_rho&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                              <span class="s1">&#39;alpha_err_l68&#39;</span><span class="p">:</span> <span class="n">k21_fig4</span><span class="p">[</span><span class="s1">&#39;alpha_rho_err_l68&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                              <span class="s1">&#39;alpha_err_u68&#39;</span><span class="p">:</span> <span class="n">k21_fig4</span><span class="p">[</span><span class="s1">&#39;alpha_rho_err_u68&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                              <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mf">25.</span><span class="p">,</span>
                              <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;Kretschmer et al. 2021, Fig. 4, $\alpha_{\rho}$&#39;</span><span class="p">}</span>


    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">3.85</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">1.15</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">n_cols</span><span class="p">,</span><span class="n">scale</span><span class="p">)</span>

    <span class="n">pad_outer</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">pad_outer</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">r_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">lblSG</span> <span class="o">=</span> <span class="s1">&#39;Self-grav&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lblSG</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="mf">3.36</span><span class="o">*</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lblSG</span><span class="p">)</span>

        <span class="n">ls</span> <span class="o">=</span> <span class="n">ls_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_arr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                <span class="n">alpha_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">][</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha_by_sg&#39;</span><span class="p">:</span>
                <span class="n">alpha_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">][</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">3.36</span><span class="o">*</span><span class="n">r_arr</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha_arr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_arr</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">lbln</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lbln</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">alpha_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbln</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">show_literature</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">n_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">zorder_lit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">lit_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">lbl</span> <span class="o">=</span> <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lbl</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="s1">&#39;ls&#39;</span> <span class="ow">in</span> <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="s1">&#39;frac_uncertainty&#39;</span> <span class="ow">in</span> <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">],</span>
                                        <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;frac_uncertainty&#39;</span><span class="p">]),</span>
                                        <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;frac_uncertainty&#39;</span><span class="p">]),</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ls&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                                        <span class="n">lw</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
                                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder_lit</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha_by_sg&#39;</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">],</span>
                                        <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">3.36</span><span class="o">*</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;frac_uncertainty&#39;</span><span class="p">]),</span>
                                        <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">3.36</span><span class="o">*</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;frac_uncertainty&#39;</span><span class="p">]),</span>
                                        <span class="n">ls</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ls&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                                        <span class="n">lw</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
                                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder_lit</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">],</span> <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ls&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
                                    <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder_lit</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha_by_sg&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">],</span>
                                    <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">3.36</span><span class="o">*</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">]),</span>
                                    <span class="n">ls</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;ls&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
                                    <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder_lit</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># -------</span>
                        <span class="c1"># Show uncertainties:</span>
                        <span class="k">if</span> <span class="s1">&#39;alpha_err_l68&#39;</span> <span class="ow">in</span> <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="k">if</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                                    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">],</span> <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                            <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha_err_l68&#39;</span><span class="p">],</span>
                                                    <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha_err_u68&#39;</span><span class="p">]],</span>
                                            <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                                            <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span>
                                            <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder_lit</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                                <span class="k">elif</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha_by_sg&#39;</span><span class="p">:</span>
                                    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">],</span>
                                            <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">3.36</span><span class="o">*</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">]),</span>
                                            <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha_err_l68&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">3.36</span><span class="o">*</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">]),</span>
                                                    <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha_err_u68&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">3.36</span><span class="o">*</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">])],</span>
                                            <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                                            <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span>
                                            <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder_lit</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="c1"># -------</span>

                        <span class="k">if</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">],</span> <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">],</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;marker&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="mf">30.</span><span class="p">),</span>
                                    <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder_lit</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha_by_sg&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">],</span>
                                    <span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">3.36</span><span class="o">*</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RtoRe&#39;</span><span class="p">]),</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;marker&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">lit_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ms&#39;</span><span class="p">,</span> <span class="mf">30.</span><span class="p">),</span>
                                    <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder_lit</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alpha_by_sg&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_title</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>

        <span class="n">xydelt</span> <span class="o">=</span> <span class="mf">0.04</span>
        <span class="k">if</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lowerright&#39;</span><span class="p">:</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="n">xydelt</span><span class="p">)</span>
            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span>
            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
        <span class="k">elif</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;upperright&#39;</span><span class="p">:</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">)</span>
            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_arr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann_latex_sm</span><span class="p">,</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">2.</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.75</span>
            <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
            <span class="n">labelspacing</span><span class="o">=</span> <span class="mf">0.2</span>
            <span class="n">handletextpad</span><span class="o">=</span> <span class="mf">0.5</span>
            <span class="n">fancybox</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
            <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
            <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
            <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
                <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor</span><span class="p">,</span>
                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
                <span class="n">fancybox</span><span class="o">=</span><span class="n">fancybox</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
                <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">)</span>

            <span class="n">patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">FancyBboxPatch</span><span class="p">((</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">5.95</span><span class="p">),</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">3.55</span><span class="p">,</span>
                             <span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;square,pad=0.&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_literature</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.75</span>
            <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
            <span class="n">labelspacing</span><span class="o">=</span> <span class="mf">0.2</span>
            <span class="n">handletextpad</span><span class="o">=</span> <span class="mf">0.5</span>
            <span class="n">fancybox</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
            <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
            <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.075</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
            <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
                <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor</span><span class="p">,</span>
                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
                <span class="n">fancybox</span><span class="o">=</span><span class="n">fancybox</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
                <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">)</span>

            <span class="n">patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">FancyBboxPatch</span><span class="p">((</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.625</span><span class="p">),</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.275</span><span class="p">,</span>
                             <span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;square,pad=0.&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">5.</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 10</span>

<span class="k">def</span> <span class="nf">plot_AD_sersic_potential_alpha_vs_R</span><span class="p">(</span><span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">sigma0_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">30.</span><span class="p">,</span> <span class="mf">60.</span><span class="p">,</span> <span class="mf">90.</span><span class="p">],</span> <span class="n">q_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">n_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">],</span>
            <span class="n">total_mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="mf">10.5</span><span class="p">),</span> <span class="n">Reff</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
            <span class="n">show_sigmar_toy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_sigmar_toy_nosig0</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot pressure support using alpha=-dlnrho_g/dlnr derived for deprojected</span>
<span class="sd">    Sersic distributions, over a range of Sersic index n and intrinsic axis ratios q.</span>
<span class="sd">    Compare to self-gravitating exponential disk case (eg Burkert+10).</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to directory containing the Sersic profile tables.</span>

<span class="sd">        sigma0_arr: array_like, optional</span>
<span class="sd">            Intrinsic constant velocity dispersions to plot (km/s).</span>
<span class="sd">            Default: [30., 60., 90.]</span>
<span class="sd">        q_arr: array_like, optional</span>
<span class="sd">            Range of intrinsic axis ratios to plot. Default: q_arr = [1., 0.2]</span>
<span class="sd">        n_arr: array_like, optional</span>
<span class="sd">            Range of Sersic indices to plot. Default: n_arr = [0.5, 1., 2., 4.]</span>

<span class="sd">        total_mass: float, optional</span>
<span class="sd">            Total mass of the Sersic component (Msun). Default: 10^10.5 Msun.</span>
<span class="sd">        Reff: float, optional</span>
<span class="sd">            Effective radius of the Sersic component (kpc). Default: 1 kpc</span>

<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;AD_sersic_potential_alpha_vs_r&#39;</span>
        <span class="k">if</span> <span class="n">show_sigmar_toy</span><span class="p">:</span>
            <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_sigmar_toy&#39;</span>
        <span class="k">if</span> <span class="n">show_sigmar_toy_nosig0</span><span class="p">:</span>
            <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;_sigmar_toy_nosig0&#39;</span>
        <span class="n">fileout</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>

    <span class="c1">####################</span>
    <span class="n">n_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">n_arr</span><span class="p">)</span>
    <span class="n">q_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q_arr</span><span class="p">)</span>

    <span class="n">labels</span><span class="p">,</span> <span class="n">color_arr</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">color_arr_basic</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:orange&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sig0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sigma0_arr</span><span class="p">):</span>
        <span class="n">color_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color_arr_basic</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_0=&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{:0.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sig0</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\ \mathrm{km\,s^{-1}}$&#39;</span><span class="p">)</span>

    <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R/R_{\mathrm</span><span class="si">{e}</span><span class="s1">}$&#39;</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v(R)\ \mathrm{[km\,s^{-1}]}$&#39;</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">]</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">340.</span><span class="p">]</span>

    <span class="c1"># Load files:</span>
    <span class="n">delR</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">Rarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">delR</span><span class="p">,</span> <span class="n">delR</span><span class="p">)</span><span class="o">*</span><span class="n">Reff</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]</span>
    <span class="n">ks_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_arr</span><span class="p">:</span>
        <span class="n">invq</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">q</span>
        <span class="n">ks_dict_q</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_arr</span><span class="p">):</span>
            <span class="n">ks_dict_q</span><span class="p">[</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">tab</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">read_profile_table</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">q</span> <span class="o">==</span> <span class="n">q_arr</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">n_arr</span><span class="o">.</span><span class="n">min</span><span class="p">()):</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Reff</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;narr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_arr</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;qarr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">q_arr</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rarr</span>
                <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;total_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_mass</span>

            <span class="n">ks_dict_q</span><span class="p">[</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_dlnrho_dlnR_nearest</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Rarr</span><span class="p">,</span>
                        <span class="n">Reff</span><span class="o">=</span><span class="n">Reff</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">ks_dict_q</span><span class="p">[</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)][</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_VC_nearest</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">Rarr</span><span class="p">,</span>
                        <span class="n">total_mass</span><span class="o">=</span><span class="n">total_mass</span><span class="p">,</span> <span class="n">Reff</span><span class="o">=</span><span class="n">Reff</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">invq</span><span class="o">=</span><span class="n">invq</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>

        <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;q=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ks_dict_q</span>

    <span class="n">titles</span><span class="p">,</span> <span class="n">ann_arr</span><span class="p">,</span> <span class="n">ann_arr_pos</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_arr</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">nann</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nann</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:0.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n=&#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nann</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q_arr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">!=</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">qstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:0.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:0.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">ann_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_0=&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qstr</span><span class="p">))</span>
        <span class="n">ann_arr_pos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;upperright&#39;</span><span class="p">)</span>

    <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span>


    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">2.9</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_arr</span><span class="p">)</span>
    <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">q_arr</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mf">1.05</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="n">n_cols</span><span class="p">,</span><span class="n">scale</span><span class="o">*</span><span class="n">n_rows</span><span class="p">)</span>
    <span class="n">pad_outer</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">pad_outer</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="n">pad_outer</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]))</span>

    <span class="n">r_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;Reff&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q_arr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_arr</span><span class="p">):</span>
            <span class="n">mm</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="n">n_cols</span><span class="o">+</span><span class="n">i</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">mm</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">sig0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sigma0_arr</span><span class="p">):</span>
                <span class="n">vcirc</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;q=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)][</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)][</span><span class="s1">&#39;vcirc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;q=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">q</span><span class="p">)][</span><span class="s1">&#39;n=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mm</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">lbl_sig0</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lbl_sig0</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">lbl_circ</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_{\mathrm</span><span class="si">{circ}</span><span class="s1">}$&#39;</span>
                    <span class="n">lbl_alpha</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_{\mathrm</span><span class="si">{rot}</span><span class="s1">}$, $\alpha(n)$&#39;</span>
                    <span class="n">lbl_SG</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_{\mathrm</span><span class="si">{rot}</span><span class="s1">}$, Self-grav&#39;</span>
                    <span class="n">lbl_alpha_sigmar</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_{\mathrm</span><span class="si">{rot}</span><span class="s1">}$, $\alpha(n)+\alpha_{\sigma(r)}$&#39;</span>
                    <span class="n">lbl_alpha_sigmar_nosig0</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$v_{\mathrm</span><span class="si">{rot}</span><span class="s1">}$, $\alpha(n)+\alpha_{\sigma(r)}$, $\sigma_0=0$&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lbl_circ</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">lbl_alpha</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">lbl_SG</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">lbl_alpha_sigmar</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">lbl_alpha_sigmar_nosig0</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">vcirc</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl_circ</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">lbl_alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl_alpha</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">show_sigmar_toy</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="n">lbl_alpha_sigmar</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">show_sigmar_toy_nosig0</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl_alpha_sigmar_nosig0</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl_SG</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">lbl_sig0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl_sig0</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">sig0</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">show_sigmar_toy</span><span class="p">:</span>
                    <span class="n">sigr</span> <span class="o">=</span>  <span class="n">_sigr_toy</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">sig0</span><span class="p">,</span> <span class="n">sig0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Reff</span><span class="p">)</span>
                    <span class="n">alphasigr</span> <span class="o">=</span> <span class="n">_alpha_sigr_toy</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">sig0</span><span class="p">,</span> <span class="n">sig0</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Reff</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">alphasigr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sigr</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">show_sigmar_toy_nosig0</span><span class="p">:</span>
                    <span class="n">sigr_nosig0</span> <span class="o">=</span> <span class="n">_sigr_toy</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span><span class="p">)</span><span class="o">*</span><span class="n">sig0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Reff</span><span class="p">)</span>
                    <span class="n">alphasigr_nosig0</span> <span class="o">=</span> <span class="n">_alpha_sigr_toy</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span><span class="p">)</span><span class="o">*</span><span class="n">sig0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Reff</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">sigr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigr_nosig0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">alphasigr_nosig0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sigr_nosig0</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span>
                            <span class="n">ls</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vcirc</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mf">3.36</span><span class="o">*</span><span class="n">r_arr</span><span class="o">*</span><span class="p">(</span><span class="n">sig0</span><span class="o">**</span><span class="mi">2</span><span class="p">)),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_arr</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>


            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_title</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>

            <span class="n">xydelt</span> <span class="o">=</span> <span class="mf">0.04</span>
            <span class="n">arpos</span> <span class="o">=</span> <span class="n">ann_arr_pos</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">arpos</span> <span class="o">==</span> <span class="s1">&#39;lowerright&#39;</span><span class="p">:</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="n">xydelt</span><span class="p">)</span>
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
            <span class="k">elif</span> <span class="n">arpos</span> <span class="o">==</span> <span class="s1">&#39;upperright&#39;</span><span class="p">:</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">)</span>
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
            <span class="k">elif</span> <span class="n">arpos</span> <span class="o">==</span> <span class="s1">&#39;lowerleft&#39;</span><span class="p">:</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">xydelt</span><span class="p">,</span> <span class="n">xydelt</span><span class="p">)</span>
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
            <span class="k">elif</span> <span class="n">arpos</span> <span class="o">==</span> <span class="s1">&#39;upperleft&#39;</span><span class="p">:</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">xydelt</span><span class="p">,</span> <span class="mf">1.</span><span class="o">-</span><span class="n">xydelt</span><span class="p">)</span>
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
                <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_arr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="n">va</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="n">ha</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann_latex</span><span class="p">,</span>
                    <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">20.</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">100.</span><span class="p">))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">50.</span><span class="p">))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">n_rows</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">mm</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
                <span class="n">labelspacing</span><span class="o">=</span><span class="mf">0.15</span>
                <span class="n">handletextpad</span><span class="o">=</span> <span class="mf">0.5</span>
                <span class="n">fancybox</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
                <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span>
                <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
                <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
                    <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
                    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor</span><span class="p">,</span>
                    <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
                    <span class="n">fancybox</span><span class="o">=</span><span class="n">fancybox</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------</span>
<span class="c1"># Figure 11</span>

<span class="k">def</span> <span class="nf">plot_composite_alpha_bulge_2disk_vs_r</span><span class="p">(</span><span class="n">fileout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">nDisk</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">nBulge</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span>
            <span class="n">bt_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.</span><span class="p">],</span>
            <span class="n">ReB_to_ReD_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
            <span class="n">nDisk2</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span>
            <span class="n">D2t_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.</span><span class="p">],</span>
            <span class="n">ReD2_to_ReD_arr</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span>
            <span class="n">show_BT</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_D2T</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot composite alpha for bulge+disk over a range of B/T ratios and Rebulge/Redisk,</span>
<span class="sd">    and a 2-disk system over a range of D2/T ratios and ReD2/ReD.</span>

<span class="sd">    Saves plot to PDF.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        output_path: str</span>
<span class="sd">            Path to directory where the output plot will be saved.</span>
<span class="sd">        table_path: str</span>
<span class="sd">            Path to directory containing the Sersic profile tables.</span>

<span class="sd">        bt_arr: array_like, optional</span>
<span class="sd">            Range of B/T ratios to plot. Default: bt_arr=[0.,0.25,0.5,0.75,1.]</span>
<span class="sd">        ReB_to_ReD_arr: array_like, optional</span>
<span class="sd">            Range of Re,bulge/Re,disk ratios to plot. Default: ReB_to_ReD_arr=[0.2, 0.5, 1.]</span>
<span class="sd">        nDisk: float, optional</span>
<span class="sd">            Sersic index of disk. Default: nDisk = 1.</span>
<span class="sd">        nBulge: float, optional</span>
<span class="sd">            Sersic index of bulge. Default: nBulge = 4.</span>

<span class="sd">        nDisk2: float, optional</span>
<span class="sd">            Sersic index of second disk. Defautl: nDisk2 = 1.2</span>
<span class="sd">        D2t_arr: array_like, optional</span>
<span class="sd">            Range of D2/T ratios to plot. Default: 2t_arr=[0.,0.25,0.5,0.75,1.]</span>
<span class="sd">        ReD2_to_ReD_arr: array_like, optional</span>
<span class="sd">            Range of Re,bulge/Re,disk ratios to plot. Default: ReD2_to_ReD_arr=[0.5, 1., 1.5]</span>

<span class="sd">        fileout: str, optional</span>
<span class="sd">            Override the default filename and explicitly choose the output filename</span>
<span class="sd">            (must include full path).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">output_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;output_path&#39; if &#39;fileout&#39; is not set !&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must set &#39;table_path&#39; !&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fileout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Ensure trailing slash:</span>
        <span class="k">if</span> <span class="n">output_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="n">output_path</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">if</span> <span class="n">show_BT</span> <span class="o">&amp;</span> <span class="n">show_D2T</span><span class="p">:</span>
            <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;alpha_composite_vs_r_BT_RebulgeRedisk_D2T_ReD2ReD.pdf&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">show_BT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">show_D2T</span><span class="p">:</span>
            <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;alpha_composite_vs_r_D2T_Redisk2Redisk.pdf&#39;</span>
        <span class="k">elif</span> <span class="n">show_BT</span> <span class="o">&amp;</span> <span class="p">(</span><span class="ow">not</span> <span class="n">show_D2T</span><span class="p">):</span>
            <span class="n">fileout</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">+</span><span class="s1">&#39;alpha_composite_vs_r_BT_RebulgeRedisk.pdf&#39;</span>

    <span class="c1">####################</span>
    <span class="n">bt_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">)</span>
    <span class="n">ReB_to_ReD_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span>

    <span class="n">D2t_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">D2t_arr</span><span class="p">)</span>
    <span class="n">ReD2_to_ReD_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ReD2_to_ReD_arr</span><span class="p">)</span>

    <span class="n">color_arr_bt</span><span class="p">,</span> <span class="n">labels_bt</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">color_arr_D2t</span><span class="p">,</span> <span class="n">labels_D2t</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">btextra</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">btrange</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="k">for</span> <span class="n">bt</span> <span class="ow">in</span> <span class="n">bt_arr</span><span class="p">:</span>
        <span class="n">color_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_bt</span><span class="p">((</span><span class="n">bt</span><span class="o">+</span><span class="n">btextra</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">btrange</span><span class="o">+</span><span class="n">btextra</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">bt</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">labels_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$B/T=</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">))</span>
        <span class="k">elif</span> <span class="mf">10.</span><span class="o">*</span><span class="n">bt</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">labels_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$B/T=</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$B/T=</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">))</span>


    <span class="n">D2textra</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">D2trange</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="k">for</span> <span class="n">D2t</span> <span class="ow">in</span> <span class="n">D2t_arr</span><span class="p">:</span>
        <span class="n">color_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cmap_D2t</span><span class="p">((</span><span class="n">D2t</span><span class="o">+</span><span class="n">D2textra</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">D2trange</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">D2t</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">labels_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$D_2/T=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">))</span>
        <span class="k">elif</span> <span class="mf">10.</span><span class="o">*</span><span class="n">D2t</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">labels_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$D_2/T=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$D_2/T=&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">))</span>



    <span class="n">ls_arr_bt</span><span class="p">,</span> <span class="n">dashes_arr_bt</span><span class="p">,</span> <span class="n">lw_arr_bt</span><span class="p">,</span> <span class="n">labels_reratio_bt</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">dashlen</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">dashlen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">dashlen</span> <span class="o">=</span> <span class="n">dashlen</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">dashlen</span> <span class="o">=</span> <span class="n">dashlen</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># reverse</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">reBtoreD</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lw_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.3</span><span class="p">)</span>
            <span class="n">ls_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">dashes_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">lw_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">ls_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">dashes_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lw_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">ls_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">dashes_arr_bt</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dashlen</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">lblstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,bulge}}/R_{\mathrm{e,disk}}=&#39;</span>
        <span class="k">if</span> <span class="n">reBtoreD</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lblstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)</span>
        <span class="k">elif</span> <span class="mf">10.</span><span class="o">*</span><span class="n">reBtoreD</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lblstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lblstr</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)</span>
        <span class="n">labels_reratio_bt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lblstr</span><span class="p">)</span>

    <span class="n">ls_arr_D2t</span><span class="p">,</span> <span class="n">dashes_arr_D2t</span><span class="p">,</span> <span class="n">lw_arr_D2t</span><span class="p">,</span> <span class="n">labels_reratio_D2t</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">dashlen</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReD2_to_ReD_arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">dashlen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">ReD2_to_ReD_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReD2_to_ReD_arr</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">dashlen</span> <span class="o">=</span> <span class="n">dashlen</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">ReD2_to_ReD_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">dashlen</span> <span class="o">=</span> <span class="n">dashlen</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># reverse</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">reD2toreD</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReD2_to_ReD_arr</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">reD2toreD</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">):</span>
            <span class="n">lw_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.3</span><span class="p">)</span>
            <span class="n">ls_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">dashes_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReD2_to_ReD_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">lw_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">ls_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">dashes_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lw_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span>
            <span class="n">ls_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">dashes_arr_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dashlen</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span>

        <span class="n">lblstr</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R_{\mathrm{e,disk_2}}/R_{\mathrm{e,disk}}=&#39;</span>
        <span class="k">if</span> <span class="n">reD2toreD</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lblstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)</span>
        <span class="k">elif</span> <span class="mf">10.</span><span class="o">*</span><span class="n">reD2toreD</span> <span class="o">%</span> <span class="mf">1.</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lblstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lblstr</span> <span class="o">+=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.2f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)</span>
        <span class="n">labels_reratio_D2t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lblstr</span><span class="p">)</span>



    <span class="n">q_arr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]</span>

    <span class="n">delR</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">]</span>
    <span class="n">RtoRed_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">delR</span><span class="p">,</span> <span class="n">delR</span><span class="p">)</span>
    <span class="n">Redisk</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># placeholder</span>
    <span class="n">r_arr</span> <span class="o">=</span> <span class="n">RtoRed_arr</span> <span class="o">*</span> <span class="n">Redisk</span>

    <span class="c1"># Get values:</span>
    <span class="c1"># read fits tables, construct ks dict.....</span>
    <span class="n">ks_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">invq_disk</span> <span class="o">=</span> <span class="n">invq_bulge</span> <span class="o">=</span> <span class="n">invq_disk2</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">total_mass</span> <span class="o">=</span> <span class="mf">1.e11</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">bt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">):</span>
        <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">reBtoreD</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">):</span>
            <span class="n">alphan</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_dlnrho_dlnR_two_component_nearest</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span>
                    <span class="n">mass_comp1</span><span class="o">=</span><span class="n">total_mass</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">bt</span><span class="p">),</span> <span class="n">mass_comp2</span><span class="o">=</span><span class="n">total_mass</span><span class="o">*</span><span class="n">bt</span><span class="p">,</span>
                    <span class="n">Reff_comp1</span><span class="o">=</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">n_comp1</span><span class="o">=</span><span class="n">nDisk</span><span class="p">,</span> <span class="n">invq_comp1</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span>
                    <span class="n">Reff_comp2</span><span class="o">=</span><span class="n">reBtoreD</span><span class="o">*</span><span class="n">Redisk</span><span class="p">,</span>   <span class="n">n_comp2</span><span class="o">=</span><span class="n">nBulge</span><span class="p">,</span> <span class="n">invq_comp2</span><span class="o">=</span><span class="n">invq_bulge</span><span class="p">,</span>
                    <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alphan</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color_arr_bt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;ls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ls_arr_bt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lw_arr_bt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;dashes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dashes_arr_bt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;label_bt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_bt</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;label_reratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_reratio_bt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>



    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">D2t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">D2t_arr</span><span class="p">):</span>
        <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">reD2toreD</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReD2_to_ReD_arr</span><span class="p">):</span>
            <span class="n">alphan</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">interp_profiles</span><span class="o">.</span><span class="n">interpolate_sersic_profile_dlnrho_dlnR_two_component_nearest</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="n">r_arr</span><span class="p">,</span>
                    <span class="n">mass_comp1</span><span class="o">=</span><span class="n">total_mass</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">D2t</span><span class="p">),</span> <span class="n">mass_comp2</span><span class="o">=</span><span class="n">total_mass</span><span class="o">*</span><span class="n">D2t</span><span class="p">,</span>
                    <span class="n">Reff_comp1</span><span class="o">=</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">n_comp1</span><span class="o">=</span><span class="n">nDisk</span><span class="p">,</span> <span class="n">invq_comp1</span><span class="o">=</span><span class="n">invq_disk</span><span class="p">,</span>
                    <span class="n">Reff_comp2</span><span class="o">=</span><span class="n">reD2toreD</span><span class="o">*</span><span class="n">Redisk</span><span class="p">,</span>   <span class="n">n_comp2</span><span class="o">=</span><span class="n">nDisk2</span><span class="p">,</span> <span class="n">invq_comp2</span><span class="o">=</span><span class="n">invq_disk2</span><span class="p">,</span>
                    <span class="n">path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alphan</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color_arr_D2t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;ls&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ls_arr_D2t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lw_arr_D2t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;dashes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dashes_arr_D2t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;label_D2t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_D2t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;label_reratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_reratio_D2t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

    <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$R/R_{\mathrm{e,disk}}$&#39;</span>
    <span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\alpha_{\mathrm{tot,\ disk+bulge}}(R)$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\alpha_{\mathrm{tot,\ disk+disk_2}}(R)$&#39;</span><span class="p">]</span>
    <span class="n">ylims</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">]]</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span>


    <span class="c1">######################################</span>
    <span class="c1"># Setup plot:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="mf">4.</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">show_BT</span><span class="p">:</span>
        <span class="n">n_cols</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">show_D2T</span><span class="p">:</span>
        <span class="n">n_cols</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">pad_outer</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">f</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">scale</span><span class="o">*</span><span class="p">(</span><span class="n">n_cols</span> <span class="o">+</span> <span class="n">pad_outer</span><span class="o">*</span><span class="p">(</span><span class="n">n_cols</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="n">scale</span><span class="p">)</span>

    <span class="n">pad_outer</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="n">pad_outer</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cols</span><span class="p">):</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]))</span>


    <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1">############</span>
    <span class="c1"># BT</span>
    <span class="k">if</span> <span class="n">show_BT</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">reBtoreD</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReB_to_ReD_arr</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">bt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">):</span>
                <span class="n">alpha_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                <span class="n">ls</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;ls&#39;</span><span class="p">]</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
                <span class="n">dashes</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;dashes&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha_arr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_arr</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">ls</span><span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
                        <span class="n">lbl</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;label_bt&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lbl</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">dashes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">alpha_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="n">dashes</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=-</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">reBtoreD</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="n">dashes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">alpha_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=-</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">reBtoreD</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

                <span class="c1"># Phantom plot:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ls</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">):</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;label_bt&#39;</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="n">j</span><span class="p">)</span>


                <span class="c1"># Add self-grav comparison:</span>
                <span class="n">nextra</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">lblSG</span> <span class="o">=</span> <span class="s1">&#39;Self-grav&#39;</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="mf">3.36</span><span class="o">*</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dimgrey&#39;</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lblSG</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">15.</span><span class="p">)</span>

                <span class="c1"># Phandom plots for legend:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">indbt_color</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">[</span><span class="n">indbt_color</span><span class="p">])][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;bt=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bt</span><span class="p">)][</span><span class="s1">&#39;reBtoreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reBtoreD</span><span class="p">)][</span><span class="s1">&#39;label_reratio&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">dashes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">dashes</span><span class="o">=</span><span class="n">dashes</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">2.</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>


        <span class="c1">########################################</span>
        <span class="c1"># Annotate Sersic indices:</span>
        <span class="n">ann_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n_{\mathrm</span><span class="si">{disk}</span><span class="s1">} = &#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nDisk</span><span class="p">)</span>
        <span class="n">ann_str2</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n_{\mathrm</span><span class="si">{bulge}</span><span class="s1">} = &#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nBulge</span><span class="p">)</span>
        <span class="n">xdelt</span> <span class="o">=</span> <span class="mf">0.075</span>
        <span class="n">ypos</span> <span class="o">=</span> <span class="mf">0.2275</span>
        <span class="n">ydelt</span> <span class="o">=</span> <span class="mf">0.055</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xdelt</span><span class="p">,</span> <span class="n">ypos</span><span class="o">+</span><span class="n">ydelt</span><span class="p">)</span>
        <span class="n">xy2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xdelt</span><span class="p">,</span> <span class="n">ypos</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">,</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap_bt</span><span class="p">(</span><span class="mf">0.</span><span class="o">+</span><span class="n">btextra</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str2</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy2</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">,</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap_bt</span><span class="p">(</span><span class="mf">0.9</span><span class="o">+</span><span class="n">btextra</span><span class="p">))</span>
        <span class="c1">########################################</span>

        <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
        <span class="n">labelspacing</span><span class="o">=</span> <span class="mf">0.2</span>
        <span class="n">handletextpad</span><span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">fancybox</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
        <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>

        <span class="c1"># Split into two legends:</span>
        <span class="n">len_ax1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bt_arr</span><span class="p">)</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels_leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">neworder</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_ax1</span><span class="p">)</span>
        <span class="n">handles_arr</span><span class="p">,</span> <span class="n">labels_arr</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder</span><span class="p">:</span>
            <span class="n">handles_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">labels_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

        <span class="c1"># COMPARISON SAMPLE: incl Self-grav</span>
        <span class="n">neworder3</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_ax1</span><span class="p">,</span> <span class="n">len_ax1</span><span class="o">+</span><span class="n">nextra</span><span class="p">)</span>
        <span class="n">handles_arr3</span><span class="p">,</span> <span class="n">labels_arr3</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder3</span><span class="p">:</span>
            <span class="n">handles_arr3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">labels_arr3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

        <span class="n">neworder2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_ax1</span><span class="o">+</span><span class="n">nextra</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">))</span>
        <span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder2</span><span class="p">:</span>
            <span class="n">handles_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">labels_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

        <span class="n">loc1</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
        <span class="n">bbox_to_anchor1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">legend1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr</span><span class="p">,</span> <span class="n">labels_arr</span><span class="p">,</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
            <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">loc1</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor1</span><span class="p">,</span>
            <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="n">fancybox</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
            <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">)</span>

        <span class="n">patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">FancyBboxPatch</span><span class="p">((</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">6.45</span><span class="p">),</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">3.55</span><span class="p">,</span>
                         <span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;square,pad=0.&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

        <span class="n">loc2</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span>
        <span class="n">bbox_to_anchor2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.025</span><span class="p">)</span>
        <span class="n">handlelength</span> <span class="o">=</span> <span class="mf">4.1</span>
        <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">legend2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span><span class="p">,</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
            <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">handlelength</span><span class="o">=</span><span class="n">handlelength</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">loc2</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor2</span><span class="p">,</span>
            <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="n">fancybox</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
            <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">)</span>

        <span class="n">loc3</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span>
        <span class="n">bbox_to_anchor3</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">legend3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr3</span><span class="p">,</span> <span class="n">labels_arr3</span><span class="p">,</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
            <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">loc3</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor3</span><span class="p">,</span>
            <span class="n">handlelength</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span>
            <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="n">fancybox</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
            <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend3</span><span class="p">)</span>


    <span class="c1">############</span>
    <span class="c1"># D2T</span>
    <span class="k">if</span> <span class="n">show_D2T</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ylim</span> <span class="o">=</span> <span class="n">ylims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">reD2toreD</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReD2_to_ReD_arr</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">D2t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">D2t_arr</span><span class="p">):</span>
                <span class="n">alpha_arr</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                <span class="n">ls</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;ls&#39;</span><span class="p">]</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;lw&#39;</span><span class="p">]</span>
                <span class="n">dashes</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;dashes&#39;</span><span class="p">]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alpha_arr</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_arr</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">ls</span><span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
                        <span class="n">lbl</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;label_D2t&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lbl</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="kc">None</span>


                <span class="k">if</span> <span class="n">dashes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">alpha_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="n">dashes</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=-</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">reD2toreD</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">dashes</span><span class="o">=</span><span class="n">dashes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">alpha_arr</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=-</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">reD2toreD</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">20.</span><span class="p">)</span>

                <span class="c1"># Phantom plot:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ls</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span><span class="p">):</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;label_D2t&#39;</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="n">j</span><span class="p">)</span>

                <span class="c1"># Add self-grav comparison:</span>
                <span class="n">nextra</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">D2t_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">lblSG</span> <span class="o">=</span> <span class="s1">&#39;Self-grav&#39;</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="mf">3.36</span><span class="o">*</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">),</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dimgrey&#39;</span><span class="p">,</span>
                        <span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lblSG</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mf">15.</span><span class="p">)</span>

                <span class="c1"># Phandom plots for legend:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">D2t_arr</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">indd2t_color</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t_arr</span><span class="p">[</span><span class="n">indd2t_color</span><span class="p">])][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="n">ks_dict</span><span class="p">[</span><span class="s1">&#39;D2t=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D2t</span><span class="p">)][</span><span class="s1">&#39;reD2toreD=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reD2toreD</span><span class="p">)][</span><span class="s1">&#39;label_reratio&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">dashes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                <span class="n">dashes</span><span class="o">=</span><span class="n">dashes</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_arr</span><span class="o">/</span><span class="n">Redisk</span><span class="p">,</span> <span class="n">r_arr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize_ticks</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">2.</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.02</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>

        <span class="c1">########################################</span>
        <span class="c1"># Annotate Sersic indices:</span>
        <span class="n">ann_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n_D = </span><span class="si">{:0.0f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nDisk</span><span class="p">)</span>
        <span class="n">ann_str2</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$n_</span><span class="si">{D_2}</span><span class="s1"> = &#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;</span><span class="si">{:0.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nDisk2</span><span class="p">)</span>
        <span class="n">xdelt</span> <span class="o">=</span> <span class="mf">0.21</span>
        <span class="n">ypos</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="n">ydelt</span> <span class="o">=</span> <span class="mf">0.05</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xdelt</span><span class="p">,</span> <span class="n">ypos</span><span class="o">+</span><span class="n">ydelt</span><span class="p">)</span>
        <span class="n">xy2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xdelt</span><span class="p">,</span> <span class="n">ypos</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">,</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap_D2t</span><span class="p">(</span><span class="mf">0.</span><span class="o">+</span><span class="n">D2textra</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">ann_str2</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="n">xy2</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_ann</span><span class="p">,</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap_D2t</span><span class="p">(</span><span class="mf">0.9</span><span class="o">+</span><span class="n">D2textra</span><span class="p">))</span>
        <span class="c1">########################################</span>


        <span class="n">frameon</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">framealpha</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">borderpad</span> <span class="o">=</span> <span class="mf">0.75</span>
        <span class="n">fontsize_leg_tmp</span> <span class="o">=</span> <span class="n">fontsize_leg</span>
        <span class="n">labelspacing</span><span class="o">=</span> <span class="mf">0.2</span>
        <span class="n">handletextpad</span><span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">fancybox</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span>
        <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>

        <span class="c1"># Split into two legends:</span>
        <span class="n">len_ax1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">D2t_arr</span><span class="p">)</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels_leg</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">neworder</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_ax1</span><span class="p">)</span>
        <span class="n">handles_arr</span><span class="p">,</span> <span class="n">labels_arr</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder</span><span class="p">:</span>
            <span class="n">handles_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">labels_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

        <span class="c1"># COMPARISON SAMPLE: incl Self-grav</span>
        <span class="n">neworder3</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_ax1</span><span class="p">,</span> <span class="n">len_ax1</span><span class="o">+</span><span class="n">nextra</span><span class="p">)</span>
        <span class="n">handles_arr3</span><span class="p">,</span> <span class="n">labels_arr3</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder3</span><span class="p">:</span>
            <span class="n">handles_arr3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">labels_arr3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

        <span class="n">neworder2</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_ax1</span><span class="o">+</span><span class="n">nextra</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">))</span>
        <span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span> <span class="o">=</span> <span class="p">([]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">neworder2</span><span class="p">:</span>
            <span class="n">handles_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="n">labels_arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels_leg</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

        <span class="n">loc1</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
        <span class="n">bbox_to_anchor1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">legend1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr</span><span class="p">,</span> <span class="n">labels_arr</span><span class="p">,</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
            <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">loc1</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor1</span><span class="p">,</span>
            <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="n">fancybox</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
            <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">)</span>

        <span class="n">loc2</span> <span class="o">=</span> <span class="s1">&#39;lower right&#39;</span>
        <span class="n">bbox_to_anchor2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.025</span><span class="p">)</span>
        <span class="n">handlelength</span> <span class="o">=</span> <span class="mf">5.</span>
        <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">legend2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr2</span><span class="p">,</span> <span class="n">labels_arr2</span><span class="p">,</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
            <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span> <span class="n">handlelength</span><span class="o">=</span><span class="n">handlelength</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">loc2</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor2</span><span class="p">,</span>
            <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="n">fancybox</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
            <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">)</span>

        <span class="n">loc3</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span>
        <span class="n">bbox_to_anchor3</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">legend3</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles_arr3</span><span class="p">,</span> <span class="n">labels_arr3</span><span class="p">,</span>
            <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">borderpad</span><span class="o">=</span><span class="n">borderpad</span><span class="p">,</span>
            <span class="n">handletextpad</span><span class="o">=</span><span class="n">handletextpad</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="n">frameon</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">loc3</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">bbox_to_anchor3</span><span class="p">,</span>
            <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize_leg_tmp</span><span class="p">,</span>
            <span class="n">fancybox</span><span class="o">=</span><span class="n">fancybox</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
            <span class="n">framealpha</span><span class="o">=</span><span class="n">framealpha</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">legend3</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fileout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fileout</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># From the command line, call the wrapper to make all plots.</span>
    <span class="c1"># Input args: output_path, table_path</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">table_path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">make_all_paper_plots</span><span class="p">(</span><span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span> <span class="n">table_path</span><span class="o">=</span><span class="n">table_path</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2022, Sedona Price.
      <span class="lastupdated">Last updated on 30 Jan 2023.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>